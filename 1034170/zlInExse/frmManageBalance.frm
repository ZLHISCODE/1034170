VERSION 5.00
Object = "{0ECD9B60-23AA-11D0-B351-00A0C9055D8E}#6.0#0"; "MSHFLXGD.OCX"
Object = "{38911DA0-E448-11D0-84A3-00DD01104159}#1.1#0"; "COMCT332.OCX"
Object = "{831FDD16-0C5C-11D2-A9FC-0000F8754DA1}#2.0#0"; "MSCOMCTL.OCX"
Begin VB.Form frmManageBalance 
   AutoRedraw      =   -1  'True
   Caption         =   "≤°»ÀΩ·’ ¥¶¿Ì"
   ClientHeight    =   6210
   ClientLeft      =   60
   ClientTop       =   630
   ClientWidth     =   9675
   Icon            =   "frmManageBalance.frx":0000
   KeyPreview      =   -1  'True
   ScaleHeight     =   6210
   ScaleWidth      =   9675
   ShowInTaskbar   =   0   'False
   WindowState     =   2  'Maximized
   Begin MSComctlLib.ImageList imgGray 
      Left            =   1035
      Top             =   1635
      _ExtentX        =   1005
      _ExtentY        =   1005
      BackColor       =   -2147483643
      ImageWidth      =   24
      ImageHeight     =   24
      MaskColor       =   12632256
      _Version        =   393216
      BeginProperty Images {2C247F25-8591-11D1-B16A-00C0F0283628} 
         NumListImages   =   14
         BeginProperty ListImage1 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":08CA
            Key             =   "Preview"
         EndProperty
         BeginProperty ListImage2 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":0AE4
            Key             =   "Print"
         EndProperty
         BeginProperty ListImage3 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":0CFE
            Key             =   "New"
         EndProperty
         BeginProperty ListImage4 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":0F18
            Key             =   "Del"
         EndProperty
         BeginProperty ListImage5 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":1132
            Key             =   "View"
         EndProperty
         BeginProperty ListImage6 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":18AC
            Key             =   "Find"
         EndProperty
         BeginProperty ListImage7 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":1AC6
            Key             =   "Filter"
         EndProperty
         BeginProperty ListImage8 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":1CE0
            Key             =   "Help"
         EndProperty
         BeginProperty ListImage9 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":1EFA
            Key             =   "Quit"
         EndProperty
         BeginProperty ListImage10 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":2114
            Key             =   "Adjust"
         EndProperty
         BeginProperty ListImage11 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":232E
            Key             =   "Modi"
         EndProperty
         BeginProperty ListImage12 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":2548
            Key             =   "mzBalance"
         EndProperty
         BeginProperty ListImage13 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":2C42
            Key             =   "zyBalance"
         EndProperty
         BeginProperty ListImage14 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":333C
            Key             =   "RollingCurtain"
            Object.Tag             =   "RollingCurtain"
         EndProperty
      EndProperty
   End
   Begin MSComctlLib.ImageList imgColor 
      Left            =   270
      Top             =   1965
      _ExtentX        =   1005
      _ExtentY        =   1005
      BackColor       =   -2147483643
      ImageWidth      =   24
      ImageHeight     =   24
      MaskColor       =   12632256
      _Version        =   393216
      BeginProperty Images {2C247F25-8591-11D1-B16A-00C0F0283628} 
         NumListImages   =   14
         BeginProperty ListImage1 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":CCD3
            Key             =   "Preview"
         EndProperty
         BeginProperty ListImage2 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":CEED
            Key             =   "Print"
         EndProperty
         BeginProperty ListImage3 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":D107
            Key             =   "New"
         EndProperty
         BeginProperty ListImage4 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":D321
            Key             =   "Del"
         EndProperty
         BeginProperty ListImage5 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":D53B
            Key             =   "View"
         EndProperty
         BeginProperty ListImage6 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":DCB5
            Key             =   "Find"
         EndProperty
         BeginProperty ListImage7 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":DECF
            Key             =   "Filter"
         EndProperty
         BeginProperty ListImage8 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":E0E9
            Key             =   "Help"
         EndProperty
         BeginProperty ListImage9 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":E303
            Key             =   "Quit"
         EndProperty
         BeginProperty ListImage10 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":E51D
            Key             =   "Adjust"
         EndProperty
         BeginProperty ListImage11 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":E737
            Key             =   "Modi"
         EndProperty
         BeginProperty ListImage12 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":E951
            Key             =   "mzBalance"
            Object.Tag             =   "mzBalance"
         EndProperty
         BeginProperty ListImage13 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":F04B
            Key             =   "zyBalance"
            Object.Tag             =   "zyBalance"
         EndProperty
         BeginProperty ListImage14 {2C247F27-8591-11D1-B16A-00C0F0283628} 
            Picture         =   "frmManageBalance.frx":F745
            Key             =   "RollingCurtain"
            Object.Tag             =   "RollingCurtain"
         EndProperty
      EndProperty
   End
   Begin VB.PictureBox picVsc 
      Appearance      =   0  'Flat
      AutoRedraw      =   -1  'True
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   1695
      Left            =   7410
      MousePointer    =   9  'Size W E
      ScaleHeight     =   1695
      ScaleWidth      =   45
      TabIndex        =   7
      TabStop         =   0   'False
      Top             =   4170
      Width           =   45
   End
   Begin VB.PictureBox picHsc 
      Appearance      =   0  'Flat
      AutoRedraw      =   -1  'True
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   45
      Left            =   15
      MousePointer    =   7  'Size N S
      ScaleHeight     =   45
      ScaleWidth      =   9675
      TabIndex        =   6
      TabStop         =   0   'False
      Top             =   4140
      Width           =   9675
   End
   Begin ComCtl3.CoolBar cbr 
      Align           =   1  'Align Top
      Height          =   780
      Left            =   0
      TabIndex        =   4
      Top             =   0
      Width           =   9675
      _ExtentX        =   17066
      _ExtentY        =   1376
      BandCount       =   1
      _CBWidth        =   9675
      _CBHeight       =   780
      _Version        =   "6.7.9782"
      Child1          =   "tbr"
      MinHeight1      =   720
      Width1          =   810
      NewRow1         =   0   'False
      Begin MSComctlLib.Toolbar tbr 
         Height          =   720
         Left            =   30
         TabIndex        =   5
         Top             =   30
         Width           =   9555
         _ExtentX        =   16854
         _ExtentY        =   1270
         ButtonWidth     =   820
         ButtonHeight    =   1270
         AllowCustomize  =   0   'False
         Wrappable       =   0   'False
         Style           =   1
         ImageList       =   "imgGray"
         HotImageList    =   "imgColor"
         _Version        =   393216
         BeginProperty Buttons {66833FE8-8583-11D1-B16A-00C0F0283628} 
            NumButtons      =   15
            BeginProperty Button1 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "‘§¿¿"
               Key             =   "Preview"
               Description     =   "‘§¿¿"
               Object.ToolTipText     =   "‘§¿¿"
               Object.Tag             =   "‘§¿¿"
               ImageKey        =   "Preview"
            EndProperty
            BeginProperty Button2 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "¥Ú”°"
               Key             =   "Print"
               Description     =   "¥Ú”°"
               Object.ToolTipText     =   "¥Ú”°"
               Object.Tag             =   "¥Ú”°"
               ImageKey        =   "Print"
            EndProperty
            BeginProperty Button3 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Style           =   3
            EndProperty
            BeginProperty Button4 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "√≈’Ô"
               Key             =   "MzBalance"
               Object.ToolTipText     =   "Ω¯»Î√≈’ÔΩ·’ ¥∞ø⁄"
               Object.Tag             =   "√≈’Ô"
               ImageKey        =   "mzBalance"
            EndProperty
            BeginProperty Button5 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "◊°‘∫"
               Key             =   "ZyBalance"
               Description     =   "Ω·’ "
               Object.ToolTipText     =   "Ω¯»Î◊°‘∫Ω·’ ¥∞ø⁄"
               Object.Tag             =   "◊°‘∫"
               ImageKey        =   "zyBalance"
            EndProperty
            BeginProperty Button6 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "◊˜∑œ"
               Key             =   "Del"
               Description     =   "◊˜∑œ"
               Object.ToolTipText     =   "Ω´µ±«∞—°÷–µ•æ›◊˜∑œ"
               Object.Tag             =   "◊˜∑œ"
               ImageKey        =   "Del"
            EndProperty
            BeginProperty Button7 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "≤È‘ƒ"
               Key             =   "View"
               Description     =   "≤È‘ƒ"
               Object.ToolTipText     =   "≤È‘ƒµ±«∞µ•æ›µƒƒ⁄»›"
               Object.Tag             =   "≤È‘ƒ"
               ImageKey        =   "View"
            EndProperty
            BeginProperty Button8 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Style           =   3
            EndProperty
            BeginProperty Button9 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "π˝¬À"
               Key             =   "Filter"
               Description     =   "π˝¬À"
               Object.ToolTipText     =   "∞¥…Ë÷√Ãıº˛÷ÿ–¬…∏—°º«¬º"
               Object.Tag             =   "π˝¬À"
               ImageKey        =   "Filter"
            EndProperty
            BeginProperty Button10 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "∂®Œª"
               Key             =   "Go"
               Description     =   "∂®Œª"
               Object.ToolTipText     =   "∂®ŒªµΩ¬˙◊„Ãıº˛µƒº«¬º…œ"
               Object.Tag             =   "∂®Œª"
               ImageKey        =   "Find"
            EndProperty
            BeginProperty Button11 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Style           =   3
            EndProperty
            BeginProperty Button12 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "‘˛’ "
               Key             =   "‘˛’ "
               Object.ToolTipText     =   " ’∑—‘˛’ "
               Object.Tag             =   "‘˛’ "
               ImageKey        =   "RollingCurtain"
            EndProperty
            BeginProperty Button13 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Key             =   "SplitRollingCurtain"
               Style           =   3
            EndProperty
            BeginProperty Button14 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "∞Ô÷˙"
               Key             =   "Help"
               Description     =   "∞Ô÷˙"
               Object.ToolTipText     =   "µ±«∞∞Ô÷˙÷˜Ã‚"
               Object.Tag             =   "∞Ô÷˙"
               ImageKey        =   "Help"
            EndProperty
            BeginProperty Button15 {66833FEA-8583-11D1-B16A-00C0F0283628} 
               Caption         =   "ÕÀ≥ˆ"
               Key             =   "Quit"
               Description     =   "ÕÀ≥ˆ"
               Object.ToolTipText     =   "ÕÀ≥ˆ"
               Object.Tag             =   "ÕÀ≥ˆ"
               ImageKey        =   "Quit"
            EndProperty
         EndProperty
      End
   End
   Begin MSComctlLib.StatusBar stbThis 
      Align           =   2  'Align Bottom
      Height          =   360
      Left            =   0
      TabIndex        =   3
      Top             =   5844
      Width           =   9672
      _ExtentX        =   17066
      _ExtentY        =   635
      _Version        =   393216
      BeginProperty Panels {8E3867A5-8586-11D1-B16A-00C0F0283628} 
         NumPanels       =   4
         BeginProperty Panel1 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            AutoSize        =   2
            Bevel           =   2
            Object.Width           =   2355
            MinWidth        =   882
            Picture         =   "frmManageBalance.frx":FE3F
            Text            =   "÷–¡™»Ìº˛"
            TextSave        =   "÷–¡™»Ìº˛"
            Key             =   "ZLFLAG"
            Object.ToolTipText     =   "ª∂”≠ π”√÷–¡™”–œﬁπ´Àæ»Ìº˛"
         EndProperty
         BeginProperty Panel2 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            AutoSize        =   1
            Object.Width           =   11986
         EndProperty
         BeginProperty Panel3 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            Style           =   2
            Alignment       =   1
            AutoSize        =   2
            Object.Width           =   1058
            MinWidth        =   1058
            Text            =   " ˝◊÷"
            TextSave        =   " ˝◊÷"
            Key             =   "STANUM"
         EndProperty
         BeginProperty Panel4 {8E3867AB-8586-11D1-B16A-00C0F0283628} 
            Style           =   1
            Alignment       =   1
            AutoSize        =   2
            Enabled         =   0   'False
            Object.Width           =   1058
            MinWidth        =   1058
            Text            =   "¥Û–¥"
            TextSave        =   "¥Û–¥"
            Key             =   "STACAPS"
         EndProperty
      EndProperty
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "ÀŒÃÂ"
         Size            =   9
         Charset         =   134
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
   End
   Begin MSHierarchicalFlexGridLib.MSHFlexGrid mshMoney 
      Height          =   1665
      Left            =   7470
      TabIndex        =   2
      Top             =   4185
      Width           =   2205
      _ExtentX        =   3889
      _ExtentY        =   2937
      _Version        =   393216
      FixedCols       =   0
      RowHeightMin    =   250
      GridColor       =   -2147483636
      GridColorFixed  =   -2147483636
      AllowBigSelection=   0   'False
      ScrollTrack     =   -1  'True
      FocusRect       =   0
      GridLinesFixed  =   1
      SelectionMode   =   1
      AllowUserResizing=   1
      MouseIcon       =   "frmManageBalance.frx":106D3
      _NumberOfBands  =   1
      _Band(0).Cols   =   2
   End
   Begin MSHierarchicalFlexGridLib.MSHFlexGrid mshDetail 
      Height          =   1665
      Left            =   0
      TabIndex        =   1
      Top             =   4185
      Width           =   7380
      _ExtentX        =   13018
      _ExtentY        =   2937
      _Version        =   393216
      FixedCols       =   0
      RowHeightMin    =   250
      GridColor       =   -2147483636
      GridColorFixed  =   -2147483636
      AllowBigSelection=   0   'False
      ScrollTrack     =   -1  'True
      FocusRect       =   0
      GridLinesFixed  =   1
      SelectionMode   =   1
      AllowUserResizing=   1
      MouseIcon       =   "frmManageBalance.frx":109ED
      _NumberOfBands  =   1
      _Band(0).Cols   =   2
   End
   Begin MSHierarchicalFlexGridLib.MSHFlexGrid mshList 
      Height          =   3315
      Left            =   90
      TabIndex        =   0
      Top             =   825
      Width           =   9675
      _ExtentX        =   17066
      _ExtentY        =   5847
      _Version        =   393216
      FixedCols       =   0
      RowHeightMin    =   250
      GridColor       =   -2147483636
      GridColorFixed  =   -2147483636
      AllowBigSelection=   0   'False
      ScrollTrack     =   -1  'True
      FocusRect       =   0
      GridLinesFixed  =   1
      SelectionMode   =   1
      AllowUserResizing=   1
      MouseIcon       =   "frmManageBalance.frx":10D07
      _NumberOfBands  =   1
      _Band(0).Cols   =   2
   End
   Begin VB.Menu mnuFile 
      Caption         =   "Œƒº˛(&F)"
      Begin VB.Menu mnuFile_PrintSet 
         Caption         =   "¥Ú”°…Ë÷√(&S)"
      End
      Begin VB.Menu mnuFile_PreView 
         Caption         =   "¥Ú”°‘§¿¿(&V)"
      End
      Begin VB.Menu mnuFile_Print 
         Caption         =   "¥Ú”°(&P)"
         Shortcut        =   ^P
      End
      Begin VB.Menu mnuFile_Excel 
         Caption         =   " ‰≥ˆµΩ&Excel"
      End
      Begin VB.Menu mnuFile_1 
         Caption         =   "-"
      End
      Begin VB.Menu mnuFileMoneyEnum 
         Caption         =   "œ÷Ωµ„≥Æ(&E)"
         Shortcut        =   {F9}
      End
      Begin VB.Menu mnuFile_2 
         Caption         =   "-"
      End
      Begin VB.Menu mnuFileRollingCurtain 
         Caption         =   " ’∑—‘˛’ (&M)"
         Shortcut        =   {F11}
      End
      Begin VB.Menu mnuFileRollingCurtainSplit 
         Caption         =   "-"
      End
      Begin VB.Menu mnuFileInsure 
         Caption         =   "±£œ’¿‡±(&I)"
      End
      Begin VB.Menu mnuFileLocalSet 
         Caption         =   "≤Œ ˝…Ë÷√(&R)"
         Shortcut        =   {F12}
      End
      Begin VB.Menu mnuFileLocalSet_ 
         Caption         =   "-"
      End
      Begin VB.Menu mnuFile_quit 
         Caption         =   "ÕÀ≥ˆ(&X)"
      End
   End
   Begin VB.Menu mnuEdit 
      Caption         =   "±‡º≠(&E)"
      Begin VB.Menu mnuEdit_MzBalance 
         Caption         =   "√≈’Ô≤°»ÀΩ·’ (&M)"
         Shortcut        =   ^M
      End
      Begin VB.Menu mnuEdit_ZyBalance 
         Caption         =   "◊°‘∫≤°»ÀΩ·’ (&A)"
         Shortcut        =   ^A
      End
      Begin VB.Menu mnuEdit_BalanceBat 
         Caption         =   "≈˙¡ø÷–ÕæΩ·’ (&T)"
         Shortcut        =   {F2}
      End
      Begin VB.Menu mnuEdit_BalanceUnit 
         Caption         =   "∫œ‘ºµ•ŒªΩ·’ (&U)"
         Shortcut        =   {F4}
      End
      Begin VB.Menu mnuEdit_Due 
         Caption         =   "”¶ ’øÓπ‹¿Ì(&Y)"
         Shortcut        =   {F8}
      End
      Begin VB.Menu mnuEdit_RefundDeposit 
         Caption         =   "”‡∂ÓÕÀøÓ(&R)"
      End
      Begin VB.Menu mnuEditSplitMZ 
         Caption         =   "-"
      End
      Begin VB.Menu mnuEditMzToZy 
         Caption         =   "√≈’Ô∑—”√◊™◊°‘∫(&Z)"
      End
      Begin VB.Menu mnuEditmzXZ 
         Caption         =   "◊™◊°‘∫∑—”√œ˙’ (&X)"
      End
      Begin VB.Menu mnuEditYbVerfy 
         Caption         =   "“Ω±£–£∂‘(&C)"
         Visible         =   0   'False
      End
      Begin VB.Menu mnuEdit_0 
         Caption         =   "-"
      End
      Begin VB.Menu mnuEdit_Del 
         Caption         =   "µ•æ›◊˜∑œ(&D)"
         Shortcut        =   {DEL}
      End
      Begin VB.Menu mnuEdit_View 
         Caption         =   "≤È‘ƒµ•æ›(&V)"
      End
      Begin VB.Menu mnuEdit_1 
         Caption         =   "-"
      End
      Begin VB.Menu mnuEdit_Print 
         Caption         =   "÷ÿ¥ÚΩ·’ ∆±æ›(&R)"
      End
      Begin VB.Menu mnuEdit_Print_Supplemental 
         Caption         =   "≤π¥ÚΩ·’ ∆±æ›(&B)"
      End
      Begin VB.Menu mnuEdit_PrintDetail 
         Caption         =   "¥Ú”°Ω·’ √˜œ∏(&L)"
      End
      Begin VB.Menu mnuEditPatiPrint 
         Caption         =   "∞¥≤°»À≤π¥ÚΩ·’ ∆±æ›(&P)"
      End
      Begin VB.Menu mnuEditSplitWriteCard 
         Caption         =   "-"
      End
      Begin VB.Menu mnuEditWriteCard 
         Caption         =   "Ω·’ –≈œ¢–¥ø®(&W)"
      End
   End
   Begin VB.Menu mnuReport 
      Caption         =   "±®±Ì(&R)"
      Visible         =   0   'False
      Begin VB.Menu mnuReportItem 
         Caption         =   "-"
         Index           =   0
      End
   End
   Begin VB.Menu mnuView 
      Caption         =   "≤Èø¥(&V)"
      Begin VB.Menu mnuViewTool 
         Caption         =   "π§æﬂ¿∏(&T)"
         Begin VB.Menu mnuViewToolButton 
            Caption         =   "±Í◊º∞¥≈•(&S)"
            Checked         =   -1  'True
         End
         Begin VB.Menu mnuView_Tlb_1 
            Caption         =   "-"
         End
         Begin VB.Menu mnuViewToolText 
            Caption         =   "Œƒ±æ±Í«©(&T)"
            Checked         =   -1  'True
         End
      End
      Begin VB.Menu mnuViewStatus 
         Caption         =   "◊¥Ã¨¿∏(&S)"
         Checked         =   -1  'True
      End
      Begin VB.Menu mnuView_3 
         Caption         =   "-"
      End
      Begin VB.Menu mnuViewFilter 
         Caption         =   "π˝¬À(&F)"
         Shortcut        =   ^F
      End
      Begin VB.Menu mnuViewGo 
         Caption         =   "∂®Œª(&G)"
         Shortcut        =   ^G
      End
      Begin VB.Menu mnuView_4 
         Caption         =   "-"
      End
      Begin VB.Menu mnuViewRefeshOption 
         Caption         =   "À¢–¬∑Ω Ω(&O)"
         Begin VB.Menu mnuViewRefeshOptionItem 
            Caption         =   "≤Ÿ◊˜∫Û≤ª“™À¢–¬ ˝æ›(&1)"
            Checked         =   -1  'True
            Index           =   0
         End
         Begin VB.Menu mnuViewRefeshOptionItem 
            Caption         =   "≤Ÿ◊˜∫ÛÃ· æ «∑ÒÀ¢–¬(&2)"
            Index           =   1
         End
         Begin VB.Menu mnuViewRefeshOptionItem 
            Caption         =   "≤Ÿ◊˜∫Û◊‘∂ØÀ¢–¬ ˝æ›(&3)"
            Index           =   2
         End
      End
      Begin VB.Menu mnuView_2 
         Caption         =   "-"
      End
      Begin VB.Menu mnuViewreFlash 
         Caption         =   "À¢–¬(&R)"
         Shortcut        =   {F5}
      End
   End
   Begin VB.Menu mnuHelp 
      Caption         =   "∞Ô÷˙(&H)"
      Begin VB.Menu mnuHelpTitle 
         Caption         =   "∞Ô÷˙÷˜Ã‚(&H)"
         Shortcut        =   {F1}
      End
      Begin VB.Menu mnuHelpWeb 
         Caption         =   "&WEB…œµƒ÷–¡™"
         Begin VB.Menu mnuHelpWebHome 
            Caption         =   "÷–¡™÷˜“≥(&H)"
         End
         Begin VB.Menu mnuHelpWebForum 
            Caption         =   "÷–¡™¬€Ã≥(&F)"
         End
         Begin VB.Menu mnuHelpWebMail 
            Caption         =   "∑¢ÀÕ∑¥¿°(&K)..."
         End
      End
      Begin VB.Menu mnuHelp_1 
         Caption         =   "-"
      End
      Begin VB.Menu mnuHelpAbout 
         Caption         =   "πÿ”⁄(&A)..."
      End
   End
End
Attribute VB_Name = "frmManageBalance"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit '“™«Û±‰¡ø…˘√˜
Private mstrPrivs As String
Private mlngModul As Long
Private mrsList As ADODB.Recordset  'µ•æ›¡–±Ì
Private mrsDetail As ADODB.Recordset
Private mrsMoney As ADODB.Recordset
Private Type Type_SQLCondition
    Default As Boolean          ' «∑Ò «»± °Ω¯»Î£¨¥À ±√ª”–Ãıº˛÷µ,»± °÷µ‘⁄mstrFilter÷–
    DateB As Date
    DateE As Date
    NOB As String
    NOE As String
    FactB As String
    FactE As String
    InPatientID As String
    OutExseID As String
    Patient As String
    Operator As String
    Flag As Byte
    str¿¥‘¥ As String   '0000:√≈’Ô;◊°‘∫;ÃÂºÏ;∆‰À˚
End Type
Private SQLCondition As Type_SQLCondition

Private mstrFilter As String
Private mblnMax As Boolean
Private mblnGo As Boolean, mlngGo As Long
Private mlngCurRow As Long, mlngTopRow As Long
Private mblnNOMoved As Boolean 'º«¬ºµ±«∞—°‘Òµƒµ•æ› «∑Ò «‘⁄∫Û±∏ ˝æ›±Ì÷–
Private mbytType As Byte    'º«¬º–‘÷ 1-Ω·’ º«¬º,2-◊˜∑œ–¬º«¬º,3-◊˜∑œ‘≠º«¬º
Private mobjInPati As Object
Private mbln¡¢º¥œ˙’   As Boolean
Private mstrWriteCardTypeIDs As String   'µ±«∞∞¸∫¨µƒÀ˘”–ø®¿‡±ID
Private mstrPrivs_RollingCurtain As String  ' ’∑—‘˛’ π‹¿Ì»®œﬁ
Private mbln“Ω±£–£∂‘ As Boolean '“Ω±£–Ë“™–£∂‘

Private Sub Form_Activate()
    Call InitLocPar(mlngModul)
    Call mshList_GotFocus
End Sub

Private Sub mnuEdit_BalanceBat_Click()
    gblnOK = False
    frmBalanceBat.Show GetModuleType, Me
        
    If gblnOK Then
        If mnuViewRefeshOptionItem(1).Checked Then
            If MsgBox("µ±«∞ƒ⁄»›“—±‰ªØ,“™À¢–¬«Âµ•¬£ø", vbQuestion + vbYesNo + vbDefaultButton2, gstrSysName) = vbYes Then
                mnuViewReFlash_Click
            End If
        ElseIf mnuViewRefeshOptionItem(2).Checked Then
            mnuViewReFlash_Click
        End If
    End If
End Sub

Private Sub mnuEdit_BalanceUnit_Click()
    If frmBalanceUnit.ShowMe(Me, 0, 0, False) = False Then Exit Sub
    If mnuViewRefeshOptionItem(1).Checked Then
        If MsgBox("µ±«∞ƒ⁄»›“—±‰ªØ,“™À¢–¬«Âµ•¬£ø", vbQuestion + vbYesNo + vbDefaultButton2, gstrSysName) = vbYes Then
            mnuViewReFlash_Click
        End If
    ElseIf mnuViewRefeshOptionItem(2).Checked Then
        mnuViewReFlash_Click
    End If
End Sub

Private Sub mnuEdit_Due_Click()
    frmManageDue.mstrPrivs = mstrPrivs
    frmManageDue.mlngModul = mlngModul
    frmManageDue.Show 0, Me
End Sub



Private Sub mnuEdit_PrintDetail_Click()
    Dim strNo As String
    
    strNo = mshList.TextMatrix(mshList.Row, GetColNum("µ•æ›∫≈"))
    If strNo = "" Then
        MsgBox "µ±«∞√ª”–µ•æ›ø…“‘¥Ú”°÷§√˜£°", vbInformation, gstrSysName
        Exit Sub
    End If
    
    ' «∑Ò“—◊™»Î∫Û±∏ ˝æ›±Ì÷–
    If mblnNOMoved Then
        If Not ReturnMovedExes(strNo, 7, Me.Caption) Then Exit Sub
        mblnNOMoved = False  '¥À ±“—◊™»Î‘⁄œﬂ ˝æ›±Ì
    End If
    
    Call PrintDetail
End Sub

Private Sub mnuEdit_RefundDeposit_Click()
'---------------------------------------------------------------------------------------------------------------------------------------------
    'π¶ƒ‹:”‡∂ÓÕÀøÓ
'---------------------------------------------------------------------------------------------------------------------------------------------
    Dim objFun          As Object
    
    Err = 0: On Error Resume Next
    Set objFun = CreateObject("zl9Patient.clsPatient")
    If Err <> 0 Then Exit Sub
    
    If objFun.RefundDeposit(glngSys, gcnOracle, Me, gstrDBUser) = False Then
        Set objFun = Nothing
        Exit Sub
    End If
    Set objFun = Nothing
End Sub

Private Sub mnuEditMzToZy_Click()
    '√≈’Ô∑—”√◊™◊°‘∫∑—”√:33635
    If InStr(1, mstrPrivs, ";√≈’Ô∑—”√◊™◊°‘∫;") = 0 Then Exit Sub
    mnuEditMzToZy.Visible = InStr(1, mstrPrivs, ";√≈’Ô∑—”√◊™◊°‘∫;") > 0
    If mobjInPati Is Nothing Then
        Err = 0: On Error Resume Next
        Set mobjInPati = CreateObject("zl9InPatient.clsInPatient")
        
        If Err <> 0 Then
            MsgBox "◊¢“‚:" & vbCrLf & "   ◊°‘∫≤°»À≤øº˛(zl9InPatient)¥¥Ω® ß∞‹,«Î”ÎœµÕ≥π‹¿Ì‘±¡™œµ!"
            Exit Sub
        End If
    End If
    'zlOutFeeToInFee(
    '   ByVal frmMain As Object, ByVal cnMain As ADODB.Connection, _
    '   ByVal lngSys As Long, ByVal lngModule As Long, ByVal strPrivs As String, strDBUser As String, _
    '   ByVal lng≤°»ÀID As Long, intPatientRange As Integer)
    Call mobjInPati.zlOutFeeToInFee(Me, gcnOracle, glngSys, mlngModul, mstrPrivs, gstrDBUser, 0, 0)
End Sub

Private Sub mnuEditmzXZ_Click()
    If InStr(mstrPrivs, ";◊™◊°‘∫∑—”√œ˙’ ;") = 0 Or mbln¡¢º¥œ˙’  Then Exit Sub
    If frmFeeRefundment.zlShowEdit(Me, 2, mlngModul, mstrPrivs) = False Then
        Exit Sub
    End If
End Sub

Private Sub mnuEditPatiPrint_Click()
    '∞¥≤°»À≤π¥Ú∆±æ›:56283
    If frmMakeupPrintBill.zlRePrintBill(Me, mlngModul, mstrPrivs) = False Then Exit Sub
    If mnuViewRefeshOptionItem(1).Checked Then
        If MsgBox("µ±«∞ƒ⁄»›“—±‰ªØ,“™À¢–¬«Âµ•¬£ø", vbQuestion + vbYesNo + vbDefaultButton2, gstrSysName) = vbYes Then
            mnuViewReFlash_Click
        End If
    ElseIf mnuViewRefeshOptionItem(2).Checked Then
        mnuViewReFlash_Click
    End If
End Sub

Private Sub mnuEditWriteCard_Click()
    Dim lngCardTypeID As Long, strExpend As String, lng≤°»ÀID As Long
    Dim lngΩ·’ ID As Long, strNo As String
    Dim bytFunc As Byte
    
    With mshList
        strNo = .TextMatrix(.Row, GetColNum("µ•æ›∫≈"))
        lngΩ·’ ID = Val(.TextMatrix(.Row, GetColNum("Ω·’ ID")))
        lng≤°»ÀID = Val(.TextMatrix(.Row, GetColNum("≤°»ÀID")))
        bytFunc = IIf(Val(.TextMatrix(.Row, GetColNum("±Í÷æ"))) = 1, 0, 1)
    End With
    'π¶ƒ‹:Ω´◊°‘∫–≈œ¢–¥»Îø®÷–
    'Œ Ã‚:56615
    If mstrWriteCardTypeIDs = "" Then Exit Sub
    If bytFunc = 0 Then '√≈’Ôº«’ ∑—”√
        If InStr(mstrPrivs, ";√≈’Ô–≈œ¢–¥ø®;") = 0 Then Exit Sub
    Else
        If InStr(mstrPrivs, ";◊°‘∫–≈œ¢–¥ø®;") = 0 Then Exit Sub
    End If
    
    If strNo = "" Then
        MsgBox "µ±«∞√ª”–µ•æ›ø…“‘÷ÿ–¬–¥ø®£°", vbInformation, gstrSysName
        Exit Sub
    End If

    If InStr(1, mstrWriteCardTypeIDs, ",") = 0 Then lngCardTypeID = Val(mstrWriteCardTypeIDs)
    Call WriteInforToCard(Me, mlngModul, mstrPrivs, gobjSquare.objSquareCard, lngCardTypeID, bytFunc, lngΩ·’ ID, lng≤°»ÀID)
End Sub
Private Function IsYbBalanceCheck(ByVal lngΩ·’ ID As Long) As Boolean
    '---------------------------------------------------------------------------------------------------------------------------------------------
    'π¶ƒ‹: «∑Ò“Ω±£¥Ê‘⁄–£∂‘
    '±‡÷∆:¡ı–À∫È
    '»’∆⁄:2015-05-07 16:18:37
    '---------------------------------------------------------------------------------------------------------------------------------------------
    Dim rsTmp As ADODB.Recordset
    Dim strSql As String
    On Error GoTo errHandle
    strSql = "" & _
    "   Select Ω·À„∑Ω Ω,Ω∂Ó From ±£œ’Ω·À„√˜œ∏ " & _
    "   Where Ω·’ id = [1] And Ω·À„∑Ω Ω<>'œ÷Ω' " & _
    "           And ±Í÷æ=1 and Rownum <2"  '“Ω±£π‹øÿµƒπ˝≥ÃπÃ∂®–¥»Î¡À“ªÃı"œ÷Ω"
    
    Set rsTmp = zlDatabase.OpenSQLRecord(strSql, "±£œ’Ω·À„π‹¿Ì", lngΩ·’ ID)
    IsYbBalanceCheck = Not rsTmp.EOF
    Exit Function
errHandle:
    If ErrCenter() = 1 Then
        Resume
    End If
End Function
Private Sub mnuEditYbVerfy_Click()
    Dim strNo As String, lngΩ·’ ID As Long
    Dim intº«¬º◊¥Ã¨ As Long, str≤Ÿ◊˜‘±–’√˚ As String
    Dim blnYb As Boolean, blnThreeDeposit As Boolean
    Dim lng≤°»ÀID As Long, int‘§Ωª¿‡± As Integer
    
    With mshList
        lngΩ·’ ID = Val(.TextMatrix(.Row, GetColNum("Ω·’ ID")))
        strNo = .TextMatrix(.Row, GetColNum("µ•æ›∫≈"))
        intº«¬º◊¥Ã¨ = Val(.TextMatrix(.Row, GetColNum("º«¬º◊¥Ã¨")))
        blnYb = .TextMatrix(.Row, GetColNum("“Ω±£")) <> ""
        str≤Ÿ◊˜‘±–’√˚ = .TextMatrix(.Row, GetColNum("≤Ÿ◊˜‘±"))
    End With
    If lngΩ·’ ID = 0 Then
        MsgBox "≤ª¥Ê‘⁄–£∂‘µƒΩ·’ µ•!", vbInformation + vbOKOnly, gstrSysName
        Exit Sub
    End If
    If Not blnYb Then
        MsgBox "µ±«∞Ω·’ µ•≤ª «“Ω±£Ω·À„µ•æ›£¨≤ª¥Ê‘⁄“Ω±£–£∂‘µƒ«Èøˆ!", vbInformation + vbOKOnly, gstrSysName
        Exit Sub
    End If
    If intº«¬º◊¥Ã¨ <> 1 Then
        MsgBox "◊˜∑œµƒµ•æ›£¨≤ª¥Ê‘⁄“Ω±£–£∂‘!", vbInformation + vbOKOnly, gstrSysName
        Exit Sub
    End If
    If str≤Ÿ◊˜‘±–’√˚ <> UserInfo.–’√˚ Then
        MsgBox "µ±«∞Ω·’ µ• «≤Ÿ◊˜‘±°∞" & str≤Ÿ◊˜‘±–’√˚ & "°±≤Ÿ◊˜µƒµ•æ›£¨÷ªƒ‹∂‘◊‘º∫µƒµ•æ›Ω¯––“Ω±£–£∂‘!", vbInformation + vbOKOnly, gstrSysName
        Exit Sub
    End If
    If IsYbBalanceCheck(lngΩ·’ ID) = False Then
        MsgBox "µ±«∞Ω·’ µ•≤ª”√Ω¯–––£∂‘≤Ÿ◊˜!", vbInformation + vbOKOnly, gstrSysName
        Exit Sub
    End If
    
    If frmMedicareReckoning.ShowMeFromOut(Me, mstrPrivs, lngΩ·’ ID, blnThreeDeposit, lng≤°»ÀID, int‘§Ωª¿‡±) = False Then Exit Sub
    
    If blnThreeDeposit Then
        frmBalanceDeposit.ShowMe Me, mlngModul, lngΩ·’ ID, lng≤°»ÀID, True, False, "", "", int‘§Ωª¿‡±
    End If
    
    If mnuViewRefeshOptionItem(1).Checked Then
      If MsgBox("µ±«∞ƒ⁄»›“—±‰ªØ,“™À¢–¬«Âµ•¬£ø", vbQuestion + vbYesNo + vbDefaultButton2, gstrSysName) = vbYes Then
          mnuViewReFlash_Click
       End If
    ElseIf mnuViewRefeshOptionItem(2).Checked Then
       mnuViewReFlash_Click
    End If
End Sub

Private Sub mnuFileInsure_Click()
    gclsInsure.InsureSupport
End Sub

Private Sub mnuFileLocalSet_Click()
    frmSetExpence.mlngModul = mlngModul
    frmSetExpence.mstrPrivs = mstrPrivs
    frmSetExpence.mbytInFun = 1
    frmSetExpence.Show 1, Me
End Sub

Private Sub mnuFileMoneyEnum_Click()
    Call frmMoneyEnum.ShowMe(Me)
End Sub
 

Private Sub mnuFileRollingCurtain_Click()
   Call zlExecuteChargeRollingCurtain(Me)
End Sub

Private Sub mnuReportItem_Click(Index As Integer)
    Dim strNo As String
    
    strNo = mshList.TextMatrix(mshList.Row, GetColNum("µ•æ›∫≈"))
    If strNo = "" Then
        Call ReportOpen(gcnOracle, Split(mnuReportItem(Index).Tag, ",")(0), Split(mnuReportItem(Index).Tag, ",")(1), Me)
    Else
        With mshList
            Call ReportOpen(gcnOracle, Split(mnuReportItem(Index).Tag, ",")(0), Split(mnuReportItem(Index).Tag, ",")(1), Me, _
                "≤°»ÀID=" & .TextMatrix(.Row, GetColNum("≤°»ÀID")), _
                "◊°‘∫∫≈=" & .TextMatrix(.Row, GetColNum("◊°‘∫∫≈")), _
                "Ω·’ ID=" & .TextMatrix(.Row, GetColNum("Ω·’ ID")), _
                "NO=" & strNo, _
                "º«¬º◊¥Ã¨=" & mbytType)
        End With
    End If
End Sub

Private Sub mnuViewFilter_Click()
    frmBalanceFilter.Show 1, Me
    If gblnOK Then
        With frmBalanceFilter
            mstrFilter = .mstrFilter
            
            SQLCondition.Default = False
            SQLCondition.DateB = .dtpBegin.Value
            SQLCondition.DateE = .dtpEnd.Value
            SQLCondition.NOB = .txtNOBegin.Text
            SQLCondition.NOE = .txtNoEnd.Text
            SQLCondition.FactB = .txtFactBegin.Text
            SQLCondition.FactE = .txtFactEnd.Text
            SQLCondition.InPatientID = Trim(.txt◊°‘∫∫≈.Text)
            SQLCondition.Patient = gstrLike & UCase(.txt–’√˚.Text) & "%"
            SQLCondition.Operator = NeedName(.cbo≤Ÿ◊˜‘±.Text)
            SQLCondition.OutExseID = Trim(.txtClinic.Text)
            SQLCondition.str¿¥‘¥ = .mstr¿¥‘¥
            
            If .chkType(0).Value = 1 And .chkType(1).Value = 1 Then
                SQLCondition.Flag = 0
            ElseIf .chkType(0).Value = 1 Then
                SQLCondition.Flag = 1
            ElseIf .chkType(1).Value = 1 Then
                SQLCondition.Flag = 2
            End If
        End With
        
        mnuViewReFlash_Click
    End If
End Sub

Private Sub mshDetail_EnterCell()
    mshDetail.ForeColorSel = mshDetail.CellForeColor
End Sub

Private Sub mshDetail_GotFocus()
    Call SetActiveList(mshDetail)
End Sub

Private Sub mshList_DblClick()
    If mshList.MouseRow = 0 Then Exit Sub
    If mnuEdit_View.Enabled Then mnuEdit_View_Click
End Sub

Private Sub mshList_EnterCell()
    Dim lngΩ·’ ID As Long
    Dim strNo As String, int¿¥‘¥ As Integer
    Dim blnYb As Boolean, blnMzBalance As Boolean, blnZyBalance As Boolean
    Dim bln∆’Õ®≤°»À As Boolean, bln“Ω±£≤°»À As Boolean
    Dim bln–£∂‘ As Boolean, bytFunc As Byte
    
    lngΩ·’ ID = Val(mshList.TextMatrix(mshList.Row, GetColNum("Ω·’ ID")))
    strNo = mshList.TextMatrix(mshList.Row, GetColNum("µ•æ›∫≈"))
    mbytType = Val(mshList.TextMatrix(mshList.Row, GetColNum("º«¬º◊¥Ã¨")))
    blnYb = mshList.TextMatrix(mshList.Row, GetColNum("“Ω±£")) <> ""
    bln–£∂‘ = Trim(mshList.TextMatrix(mshList.Row, GetColNum("–£∂‘"))) <> ""
    bytFunc = IIf(Val(mshList.TextMatrix(mshList.Row, GetColNum("±Í÷æ"))) = 1, 0, 1)
    
    bln∆’Õ®≤°»À = InStr(mstrPrivs, ";∆’Õ®≤°»ÀΩ·À„;") > 0
    bln“Ω±£≤°»À = InStr(mstrPrivs, ";±£œ’Ω·À„;") > 0
    blnMzBalance = InStr(1, mstrPrivs, ";√≈’Ô∑—”√Ω·’ ;") > 0 And bln“Ω±£≤°»À
    blnZyBalance = InStr(1, mstrPrivs, ";◊°‘∫∑—”√Ω·’ ;") > 0 And bln“Ω±£≤°»À
    
    mnuEditYbVerfy.Visible = False
    If blnYb And lngΩ·’ ID <> 0 And mbytType = 1 Then
        blnYb = bln–£∂‘
        mnuEditYbVerfy.Visible = blnYb And (blnMzBalance Or blnZyBalance)
    End If
    
    If mshList.Row = 0 Or lngΩ·’ ID = 0 Then
        mnuEdit_PrintDetail.Enabled = False
        mnuEdit_Print_Supplemental.Enabled = False
        mnuEdit_Print.Enabled = False
        mnuEdit_Del.Enabled = False
        tbr.Buttons("Del").Enabled = False
        mnuEditWriteCard.Enabled = False
        Exit Sub
    End If
    
    mnuEditWriteCard.Enabled = (bytFunc = 0 And InStr(mstrPrivs, ";√≈’Ô–≈œ¢–¥ø®;") > 0) _
                            Or (bytFunc = 1 And InStr(mstrPrivs, ";◊°‘∫–≈œ¢–¥ø®;") > 0)
    int¿¥‘¥ = Val(mshList.TextMatrix(mshList.Row, GetColNum("±Í÷æ")))
    
    mlngGo = mshList.Row
    mlngCurRow = mshList.Row: mlngTopRow = mshList.TopRow
    
    Call ShowDetail(lngΩ·’ ID, , strNo, int¿¥‘¥)
    Call ShowMoney(lngΩ·’ ID, , strNo)
            
    mnuEdit_PrintDetail.Enabled = mbytType = 1
    mnuEdit_Print_Supplemental.Enabled = mbytType = 1 And Trim(mshList.TextMatrix(mshList.Row, GetColNum("∆±æ›∫≈"))) = ""
    mnuEdit_Print.Enabled = mbytType = 1
    mnuEdit_Del.Enabled = mbytType = 1 And Not bln–£∂‘
    tbr.Buttons("Del").Enabled = mbytType = 1 And Not bln–£∂‘
    
    mshList.ForeColorSel = mshList.CellForeColor
End Sub

Private Sub mshList_GotFocus()
    Call SetActiveList(mshList)
End Sub

Private Sub SetActiveList(obj As Object)
    If obj Is mshList Then
        mshList.BackColorSel = &HC0C0C0
        mshDetail.BackColorSel = &HE0E0E0
        mshMoney.BackColorSel = &HE0E0E0
    ElseIf obj Is mshDetail Then
        mshList.BackColorSel = &HE0E0E0
        mshDetail.BackColorSel = &HC0C0C0
        mshMoney.BackColorSel = &HE0E0E0
    ElseIf obj Is mshMoney Then
        mshList.BackColorSel = &HE0E0E0
        mshDetail.BackColorSel = &HE0E0E0
        mshMoney.BackColorSel = &HC0C0C0
    End If
End Sub

Private Sub mshList_KeyDown(KeyCode As Integer, Shift As Integer)
    If KeyCode = vbKeyDelete And mnuEdit_Del.Enabled And mnuEdit_Del.Visible Then Call mnuEdit_Del_Click
End Sub

Private Sub mshList_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If Button = 2 Then PopupMenu mnuEdit, 2
End Sub

Private Sub Form_KeyDown(KeyCode As Integer, Shift As Integer)
    Select Case KeyCode
        Case vbKeyF3
            ' º÷’¥”µ±«∞––ø™ º
            If mnuViewGo.Enabled Then Call SeekBill(False)
        Case vbKeyReturn
            If mnuEdit_View.Enabled Then mnuEdit_View_Click
        Case vbKeyEscape
            mblnGo = False
    End Select
End Sub

Private Sub mnuEdit_Del_Click()
    Dim strNo As String
    
    strNo = mshList.TextMatrix(mshList.Row, GetColNum("µ•æ›∫≈"))
    
    If strNo = "" Then
        MsgBox "µ±«∞√ª”–µ•æ›ø…“‘◊˜∑œ£°", vbInformation, gstrSysName
        Exit Sub
    End If
    
    frmBalance.mlngModul = mlngModul
    frmBalance.mstrPrivs = mstrPrivs
    frmBalance.mbytInState = 0
    frmBalance.mstrInNO = strNo
    frmBalance.Show GetModuleType, Me
        
    If mnuViewRefeshOptionItem(1).Checked Then
        If MsgBox("µ±«∞≤Ÿ◊˜“—∏¸∏ƒµ•æ›«Âµ•ƒ⁄»›,“™À¢–¬«Âµ•¬£ø", vbQuestion + vbYesNo + vbDefaultButton2, gstrSysName) = vbYes Then
            mnuViewReFlash_Click
        End If
    ElseIf mnuViewRefeshOptionItem(2).Checked Then
        mnuViewReFlash_Click
    End If
End Sub

Private Sub mnuHelpTitle_Click()
ShowHelp App.ProductName, Me.hWnd, Me.Name
End Sub

Private Sub mnuEdit_zyBalance_Click()
    On Error Resume Next
    Err.Clear
    
    frmBalance.mlngModul = mlngModul
    frmBalance.mstrPrivs = mstrPrivs
    frmBalance.mbytInState = 0
    frmBalance.mbytFunc = 1
    frmBalance.Show GetModuleType, Me
    If gblnOK Then
        If mnuViewRefeshOptionItem(1).Checked Then
            If MsgBox("µ±«∞ƒ⁄»›“—±‰ªØ,“™À¢–¬«Âµ•¬£ø", vbQuestion + vbYesNo + vbDefaultButton2, gstrSysName) = vbYes Then
                mnuViewReFlash_Click
            End If
        ElseIf mnuViewRefeshOptionItem(2).Checked Then
            mnuViewReFlash_Click
        End If
    End If
End Sub
Private Sub mnuEdit_MzBalance_Click()
    On Error Resume Next
    Err.Clear
    frmBalance.mlngModul = mlngModul
    frmBalance.mstrPrivs = mstrPrivs
    frmBalance.mbytInState = 0
    frmBalance.mbytFunc = 0
    frmBalance.Show GetModuleType, Me
    If gblnOK Then
        If mnuViewRefeshOptionItem(1).Checked Then
            If MsgBox("µ±«∞ƒ⁄»›“—±‰ªØ,“™À¢–¬«Âµ•¬£ø", vbQuestion + vbYesNo + vbDefaultButton2, gstrSysName) = vbYes Then
                mnuViewReFlash_Click
            End If
        ElseIf mnuViewRefeshOptionItem(2).Checked Then
            mnuViewReFlash_Click
        End If
    End If
End Sub

Private Sub mnuEdit_View_Click()
    Dim strNo As String, lngPatientID As Long, lngΩ·’ ID As Long
    
    strNo = mshList.TextMatrix(mshList.Row, GetColNum("µ•æ›∫≈"))
    If strNo = "" Then
        MsgBox "µ±«∞√ª”–µ•æ›ø…“‘≤È‘ƒ£°", vbInformation, gstrSysName
        Exit Sub
    End If
    
    On Error Resume Next
    Err.Clear
    
    lngPatientID = Val(mshList.TextMatrix(mshList.Row, GetColNum("≤°»ÀID")))
    lngΩ·’ ID = Val(mshList.TextMatrix(mshList.Row, GetColNum("Ω·’ ID")))
    If lngPatientID = 0 Then
      'œ‘ æµ•æ›ƒ⁄»›
        Call frmBalanceUnit.ShowMe(Me, 1, lngΩ·’ ID, IIf(mbytType = 2, True, False), mblnNOMoved)
    Else
        'œ‘ æµ•æ›ƒ⁄»›
        frmBalance.mlngModul = mlngModul
        frmBalance.mstrPrivs = mstrPrivs
        frmBalance.mbytInState = 1
        frmBalance.mblnViewCancel = IIf(mbytType = 2, True, False)
        frmBalance.mstrInNO = strNo
        frmBalance.mblnNOMoved = mblnNOMoved
        frmBalance.mlngBillID = Val(mshList.TextMatrix(mshList.Row, 0))
        frmBalance.Show GetModuleType, Me
    End If
End Sub

Private Sub mnuFile_quit_Click()
    Unload Me
End Sub

Private Sub mnuHelpAbout_Click()
    ShowAbout Me, App.Title, App.ProductName, App.Major & "." & App.Minor & "." & App.Revision
End Sub

Private Sub mnuViewReFlash_Click()
    ShowBills mstrFilter
End Sub

Private Sub mnuViewStatus_Click()
    mnuViewStatus.Checked = Not mnuViewStatus.Checked
    stbThis.Visible = Not stbThis.Visible
    Form_Resize
End Sub

Private Sub mnuViewToolButton_Click()
    mnuViewToolButton.Checked = Not mnuViewToolButton.Checked
    cbr.Visible = Not cbr.Visible
    mnuViewToolText.Enabled = Not mnuViewToolText.Enabled
    Form_Resize
End Sub

Private Sub mnuViewToolText_Click()
    Dim i As Long
    mnuViewToolText.Checked = Not mnuViewToolText.Checked
    For i = 1 To tbr.Buttons.Count
        tbr.Buttons(i).Caption = IIf(mnuViewToolText.Checked, tbr.Buttons(i).Tag, "")
    Next
    cbr.Bands(1).minHeight = tbr.ButtonHeight
    Form_Resize
End Sub

Private Sub mshMoney_EnterCell()
    mshMoney.ForeColorSel = mshMoney.CellForeColor
End Sub

Private Sub mshMoney_GotFocus()
    Call SetActiveList(mshMoney)
End Sub

Private Sub picHsc_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If Button = 1 Then
        If mshList.Height + Y < 1000 Or mshDetail.Height - Y < 1000 Then Exit Sub
        picHsc.Top = picHsc.Top + Y
        mshList.Height = mshList.Height + Y
        mshDetail.Top = mshDetail.Top + Y
        mshDetail.Height = mshDetail.Height - Y
        picVsc.Top = picVsc.Top + Y
        picVsc.Height = picVsc.Height - Y
        mshMoney.Top = mshMoney.Top + Y
        mshMoney.Height = mshMoney.Height - Y
        Me.Refresh
    End If
End Sub

Private Sub picHsc_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If Button = 1 Then mshList.SetFocus
End Sub

Private Sub picVsc_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If Button = 1 Then
        If mshDetail.Width + X < 1000 Or mshMoney.Width - X < 1000 Then Exit Sub
        picVsc.Left = picVsc.Left + X
        mshDetail.Width = mshDetail.Width + X
        mshMoney.Left = mshMoney.Left + X
        mshMoney.Width = mshMoney.Width - X
        Me.Refresh
    End If
End Sub

Private Sub picVsc_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If Button = 1 Then mshList.SetFocus
End Sub

Private Sub tbr_ButtonClick(ByVal Button As MSComctlLib.Button)
    Select Case Button.Key
        Case "Quit"
            mnuFile_quit_Click
        Case "Go" '∂®Œª
            mnuViewGo_Click
        Case "Filter" 'π˝¬À
            mnuViewFilter_Click
        Case "View"
            mnuEdit_View_Click
        Case "ZyBalance"
            mnuEdit_zyBalance_Click
        Case "MzBalance"
            mnuEdit_MzBalance_Click
        Case "Del"
            mnuEdit_Del_Click
        Case "Print"
            mnuFile_Print_Click
        Case "Preview"
            mnuFile_PreView_Click
        Case "‘˛’ "
            mnuFileRollingCurtain_Click
        Case "Help"
            mnuHelpTitle_Click
    End Select
End Sub

Private Sub tbr_MouseDown(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If Button = 2 Then PopupMenu mnuViewTool, 2
End Sub

Private Sub mnuFile_Excel_Click()
    Call OutputList(3)
End Sub

Private Sub mnuFile_PreView_Click()
    Call OutputList(2)
End Sub

Private Sub mnuFile_Print_Click()
    Call OutputList(1)
End Sub

Private Sub mnuFile_PrintSet_Click()
    Call zlPrintSet
End Sub

Private Sub OutputList(bytStyle As Byte)
'π¶ƒ‹£∫ ‰»Î≥ˆ¡–±Ì
'≤Œ ˝£∫bytStyle=1-¥Ú”°,2-‘§¿¿,3- ‰≥ˆµΩExcel
    Dim objOut As New zlPrint1Grd
    Dim objRow As New zlTabAppRow
    Dim bytR As Byte, intRow As Integer
    
    intRow = mshList.Row
    
    '±ÌÕ∑
    objOut.Title.Text = "≤°»ÀΩ·’ µ•æ›«Âµ•"
    objOut.Title.Font.Name = "ø¨ÃÂ_GB2312"
    objOut.Title.Font.Size = 18
    objOut.Title.Font.Bold = True
    
    '±ÌœÓ
    With frmBalanceFilter
        objRow.Add " ±º‰£∫" & Format(.dtpBegin.Value, .dtpBegin.CustomFormat) & " ÷¡ " & Format(.dtpEnd.Value, .dtpEnd.CustomFormat)
        objRow.Add "–‘÷ £∫" & IIf(mbytType = 2, "◊˜∑œµ•æ›", "Ω·’ µ•æ›")
        objOut.UnderAppRows.Add objRow
    End With
    
    Set objRow = New zlTabAppRow
    objRow.Add "¥Ú”°»À£∫" & UserInfo.–’√˚
    objRow.Add "¥Ú”°»’∆⁄£∫" & Format(zlDatabase.Currentdate(), "yyyyƒÍMM‘¬dd»’")
    objOut.BelowAppRows.Add objRow
    
    '±ÌÃÂ
    mshList.Redraw = False
    Set objOut.Body = mshList
    
    ' ‰≥ˆ
    If bytStyle = 1 Then
        bytR = zlPrintAsk(objOut)
        Me.Refresh
        If bytR <> 0 Then zlPrintOrView1Grd objOut, bytR
    Else
        zlPrintOrView1Grd objOut, bytStyle
    End If
    
    mshList.Row = intRow
    mshList.Col = 0: mshList.ColSel = mshList.Cols - 1
    mshList.Redraw = True
End Sub

Private Sub mnuHelpWebHome_Click()
    zlHomePage hWnd
End Sub

Private Sub mnuHelpWebMail_Click()
    zlMailTo hWnd
End Sub

Private Sub SetMenu(blnUsed As Boolean)
'π¶ƒ‹£∫∏˘æ›”–Œﬁº«¬º…Ë÷√≤Àµ•ø…”√◊¥Ã¨
    mnuFile_Print.Enabled = blnUsed
    mnuFile_PreView.Enabled = blnUsed
    mnuFile_Excel.Enabled = blnUsed
    tbr.Buttons("Print").Enabled = blnUsed
    tbr.Buttons("Preview").Enabled = blnUsed
    
    mnuEdit_Del.Enabled = blnUsed
    mnuEdit_View.Enabled = blnUsed
    mnuEdit_Print.Enabled = blnUsed
    mnuEdit_PrintDetail.Enabled = blnUsed
    mnuEdit_Print_Supplemental.Enabled = blnUsed
    tbr.Buttons("Del").Enabled = blnUsed
    tbr.Buttons("View").Enabled = blnUsed

    mnuViewGo.Enabled = blnUsed
    tbr.Buttons("Go").Enabled = blnUsed
End Sub
Private Sub »®œﬁøÿ÷∆()
    '---------------------------------------------------------------------------------------------------------------------------------------------
    'π¶ƒ‹:»®œﬁøÿ÷∆
    '±‡÷∆:¡ı–À∫È
    '»’∆⁄:2011-09-20 23:27:42
    '---------------------------------------------------------------------------------------------------------------------------------------------
    Dim blnMzBalance As Boolean, blnZyBalance As Boolean '√≈’ÔΩ·’ ,◊°‘∫Ω·’ 
    Dim bln∆’Õ®≤°»À As Boolean, bln“Ω±£≤°»À As Boolean, bln◊˜∑œ As Boolean
    Dim blnHavePrivs As Boolean
    
    On Error GoTo errHandle
    
    mnuEditMzToZy.Visible = InStr(1, mstrPrivs, ";√≈’Ô∑—”√◊™◊°‘∫;") > 0 '33635
    mnuEditmzXZ.Visible = InStr(mstrPrivs, ";◊™◊°‘∫∑—”√œ˙’ ;") > 0 And Not mbln¡¢º¥œ˙’ 
    mnuEditSplitMZ.Visible = InStr(mstrPrivs, ";◊™◊°‘∫∑—”√œ˙’ ;") > 0 And Not mbln¡¢º¥œ˙’  Or InStr(1, mstrPrivs, ";√≈’Ô∑—”√◊™◊°‘∫;") > 0
    
    bln∆’Õ®≤°»À = InStr(mstrPrivs, ";∆’Õ®≤°»ÀΩ·À„;") > 0
    bln“Ω±£≤°»À = InStr(mstrPrivs, ";±£œ’Ω·À„;") > 0
    blnMzBalance = InStr(1, mstrPrivs, ";√≈’Ô∑—”√Ω·’ ;") > 0 And (bln∆’Õ®≤°»À Or bln“Ω±£≤°»À)
    mnuEdit_MzBalance.Visible = blnMzBalance
    mnuEdit_BalanceUnit.Visible = blnMzBalance '∫œ‘ºµ•ŒªΩ·’ 
    tbr.Buttons("MzBalance").Visible = blnMzBalance
        
    blnZyBalance = InStr(1, mstrPrivs, ";◊°‘∫∑—”√Ω·’ ;") > 0 And (bln∆’Õ®≤°»À Or bln“Ω±£≤°»À)
    mnuEdit_ZyBalance.Visible = blnZyBalance
    tbr.Buttons("ZyBalance").Visible = blnZyBalance
    
    mnuEdit_Print.Visible = (blnZyBalance Or blnMzBalance) And InStr(mstrPrivs, ";÷ÿ¥Ú∆±æ›;") > 0 '÷ÿ¥Ú∆±æ›
    '52328
    mnuEdit_Print_Supplemental.Visible = (blnZyBalance Or blnMzBalance) And InStr(mstrPrivs, ";≤π¥Ú∆±æ›;") > 0        '≤π¥Ú∆±æ›
    'Œ Ã‚:56283
    mnuEditPatiPrint.Visible = (blnZyBalance Or blnMzBalance) And InStr(mstrPrivs, ";≤π¥Ú∆±æ›;") > 0        '≤π¥Ú∆±æ›
    
    mnuEdit_Due.Visible = InStr(mstrPrivs, ";”¶ ’øÓπ‹¿Ì;") > 0
    
    mnuEdit_BalanceBat.Visible = InStr(mstrPrivs, ";≈˙¡ø÷–ÕæΩ·’ ;") > 0
    
    'Ω·’ ∑÷∏Ù
    mnuEdit_0.Visible = blnMzBalance Or blnZyBalance Or InStr(mstrPrivs, ";”¶ ’øÓπ‹¿Ì;") > 0 Or InStr(mstrPrivs, ";≈˙¡ø÷–ÕæΩ·’ ;") > 0
    
    bln◊˜∑œ = InStr(mstrPrivs, ";Ω·’ ◊˜∑œ;") > 0 And (bln∆’Õ®≤°»À Or bln“Ω±£≤°»À)
    mnuEdit_Del.Visible = bln◊˜∑œ
    tbr.Buttons("Del").Visible = bln◊˜∑œ
    
    ' ’∑—‘˛’ π‹¿Ì
    blnHavePrivs = InStr(mstrPrivs_RollingCurtain, ";‘˛’ ;") > 0
    mnuFileRollingCurtain.Visible = blnHavePrivs
    mnuFileRollingCurtainSplit.Visible = blnHavePrivs
    tbr.Buttons("‘˛’ ").Visible = blnHavePrivs
    tbr.Buttons("SplitRollingCurtain").Visible = blnHavePrivs
    
    mnuEditSplitWriteCard.Visible = (InStr(mstrPrivs, ";◊°‘∫–≈œ¢–¥ø®;") > 0 Or InStr(mstrPrivs, ";√≈’Ô–≈œ¢–¥ø®;") > 0) _
                                    And mstrWriteCardTypeIDs <> ""
    mnuEditWriteCard.Visible = (InStr(mstrPrivs, ";◊°‘∫–≈œ¢–¥ø®;") > 0 Or InStr(mstrPrivs, ";√≈’Ô–≈œ¢–¥ø®;") > 0) _
                                And mstrWriteCardTypeIDs <> ""
    Exit Sub
errHandle:
    If ErrCenter() = 1 Then Resume
End Sub
Private Sub Form_Load()
    Dim i As Long
    
    mstrPrivs = gstrPrivs
    mlngModul = glngModul
    mstrPrivs_RollingCurtain = ";" & GetPrivFunc(glngSys, 1506) & ";"
    
    Call RestoreWinState(Me, App.ProductName)
    mbln¡¢º¥œ˙’  = Val(zlDatabase.GetPara("∑—”√◊™≥ˆ¡¢º¥ÕÀ∑—", glngSys, 1131)) = 1
    mstrWriteCardTypeIDs = ""
    If Not gobjSquare Is Nothing Then
        If Not gobjSquare.objSquareCard Is Nothing Then
            mstrWriteCardTypeIDs = gobjSquare.objSquareCard.zlGetAvailabilityWriteCardType
        End If
    End If
    
    'À¢–¬∑Ω Ω
    For i = 0 To mnuViewRefeshOptionItem.UBound
        If i = Val(zlDatabase.GetPara("À¢–¬∑Ω Ω", glngSys, mlngModul, 2)) Then
            mnuViewRefeshOptionItem(i).Checked = True
        Else
            mnuViewRefeshOptionItem(i).Checked = False
        End If
    Next
    '¥¥Ω®≤¢ºÏ≤‚À∞øÿ¥Ú”°∂‘œÛ
    If gobjTax Is Nothing Then
        On Error Resume Next
        Set gobjTax = CreateObject("zl9TaxBill.clsTaxBill")
        If Err.Number = 0 And Not gobjTax Is Nothing Then
            gblnTax = gobjTax.zlTaxUseable(2)
        End If
        On Error GoTo 0
    End If
    
    '¥¥Ω®µ⁄»˝∑Ω∆±æ›¥Ú”°≤øº˛
    On Error Resume Next
    gblnBillPrint = False
    Set gobjBillPrint = CreateObject("zlBillPrint.clsBillPrint")
    If Not gobjBillPrint Is Nothing Then
        gblnBillPrint = gobjBillPrint.zlInitialize(gcnOracle, glngSys, glngModul, UserInfo.±‡∫≈, UserInfo.–’√˚)
    End If
    On Error GoTo 0
    
    
    '»®œﬁ…Ë÷√
    Call zlDatabase.ShowReportMenu(Me, glngSys, glngModul, mstrPrivs, "ZL" & glngSys \ 100 & "_INSIDE_1137_1")
    Call »®œﬁøÿ÷∆
    
    Call ClearErrInvoice
    

    'À¢–¬ ±»± °π˝¬ÀÃıº˛(µ±ÃÏƒ⁄),Ω¯»Î ±≤ªœ‘ æ»Œ∫Œº«¬º
    mstrFilter = " And A. ’∑— ±º‰ Between Trunc(sysdate) And Trunc(sysdate+1) " & _
                 " And A.≤Ÿ◊˜‘±–’√˚||''=[1] And A.º«¬º◊¥Ã¨=1"
    SQLCondition.Default = True
    SQLCondition.Operator = UserInfo.–’√˚
            
    Call SetHeader
    Call SetDetail
    Call SetMoney
    Call SetMenu(False)
    
    stbThis.Panels(2).Text = "«ÎÀ¢–¬«Âµ•ªÚ…Ë÷√π˝¬ÀÃıº˛"
End Sub


Private Sub ClearErrInvoice()
'π¶ƒ‹£∫«Â≥˝≤Ÿ◊˜‘±…œ¥Œ“Ï≥£ÕÀ≥ˆ ±÷ªÃÓ¡À µº ∆±∫≈∂¯√ª”– µº ¥Ú”°µƒµ•æ›µƒΩ·’ º«¬º÷–µƒ∆±æ›∫≈
    Dim rsTmp As ADODB.Recordset, strSql As String, i As Long
 
    strSql = "Select A.NO" & vbNewLine & _
            "From ≤°»ÀΩ·’ º«¬º A," & vbNewLine & _
            "     (Select Max(NO) NO From ≤°»ÀΩ·’ º«¬º Where  ’∑— ±º‰ > Sysdate - 1 And ≤Ÿ◊˜‘±–’√˚ = [1]) B" & vbNewLine & _
            "Where A.NO = B.NO And A. µº ∆±∫≈ Is Not Null And Not Exists (Select 1 From ∆±æ›¥Ú”°ƒ⁄»› C Where C.NO = B.NO)"

    On Error GoTo errH
    Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, UserInfo.–’√˚)
    If rsTmp.RecordCount > 0 Then
        strSql = "Zl_∆±æ›∆ º∫≈_Update('" & rsTmp!NO & "','',3)"
        Call zlDatabase.ExecuteProcedure(strSql, Me.Caption)
    End If

    Exit Sub
errH:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Sub

Private Sub Form_Resize()
    Dim cbrH As Long, staH As Long
    Dim sngVsc As Single, sngHsc As Single

    On Error Resume Next
    
    If WindowState = 1 Then Exit Sub
    
    mshList.MousePointer = 0
    
    'øø∆Îøÿº˛øÌ∂»∫Õ∏ﬂ∂»
    cbrH = IIf(cbr.Visible, cbr.Height, 0)
    staH = IIf(stbThis.Visible, stbThis.Height, 0)
    sngVsc = mshDetail.Height / (mshDetail.Height + mshList.Height)
    sngHsc = mshMoney.Width / (mshMoney.Width + mshDetail.Width)
    
    If mblnMax Then
        sngVsc = 0.3: sngHsc = 0.2
        mblnMax = False
    End If
    If Me.WindowState = 2 Then mblnMax = True
    
    mshList.Left = Me.ScaleLeft
    mshList.Top = Me.ScaleTop + cbrH
    mshList.Width = Me.ScaleWidth
    mshList.Height = (Me.ScaleHeight - cbrH - staH - picHsc.Height) * (1 - sngVsc)
    
    picHsc.Top = mshList.Top + mshList.Height
    picHsc.Left = 0
    picHsc.Width = mshList.Width
    
    mshDetail.Left = 0
    mshDetail.Top = picHsc.Top + picHsc.Height
    mshDetail.Height = Me.ScaleHeight - cbrH - staH - picHsc.Height - mshList.Height
    mshDetail.Width = (Me.ScaleWidth - picVsc.Width) * (1 - sngHsc)
    
    picVsc.Top = mshDetail.Top
    picVsc.Left = mshDetail.Left + mshDetail.Width
    picVsc.Height = mshDetail.Height
    
    mshMoney.Top = mshDetail.Top
    mshMoney.Left = picVsc.Left + picVsc.Width
    mshMoney.Height = mshDetail.Height
    mshMoney.Width = Me.ScaleWidth - picVsc.Width - mshDetail.Width
    
    Me.Refresh
End Sub

Private Sub Form_Unload(Cancel As Integer)
    Dim i As Long
        
    mbytType = 0
    mstrFilter = ""
    Unload frmBalanceFilter
    Unload frmBalanceGo
    Call SaveWinState(Me, App.ProductName)
    '33635
    Set mobjInPati = Nothing
    'À¢–¬∑Ω Ω
    For i = 0 To mnuViewRefeshOptionItem.UBound
        If mnuViewRefeshOptionItem(i).Checked Then
            zlDatabase.SetPara "À¢–¬∑Ω Ω", i, glngSys, mlngModul, InStr(1, mstrPrivs, ";≤Œ ˝…Ë÷√;") > 0
            Exit For
        End If
    Next
    
    If Not gobjBillPrint Is Nothing Then
        Call gobjBillPrint.zlTerminate
        Set gobjBillPrint = Nothing
    End If
End Sub

Private Sub mnuViewGo_Click()
    frmBalanceGo.Show 1, Me
    If gblnOK Then Call SeekBill(frmBalanceGo.optHead)
End Sub

Private Sub SeekBill(blnHead As Boolean)
    Dim i As Long, int¿¥‘¥ As Integer
    Dim blnFill As Boolean
    Dim strNo As String
    
    Screen.MousePointer = 11
    mblnGo = True
    stbThis.Panels(2).Text = "’˝‘⁄∂®Œª¬˙◊„Ãıº˛µƒµ•æ›,∞¥ESC÷’÷π ..."
    Me.Refresh
    
    For i = IIf(blnHead, 1, mlngGo) To mshList.Rows - 1
        DoEvents
        
        '±»ΩœÃıº˛
        blnFill = True
        With frmBalanceGo
            If .txtNO.Text <> "" Then
                blnFill = blnFill And mshList.TextMatrix(i, GetColNum("µ•æ›∫≈")) = .txtNO.Text
            End If
            If .txtFact.Text <> "" Then
                blnFill = blnFill And mshList.TextMatrix(i, GetColNum("∆±æ›∫≈")) = .txtFact.Text
            End If
            If .txt◊°‘∫∫≈.Text <> "" Then
                blnFill = blnFill And mshList.TextMatrix(i, GetColNum("◊°‘∫∫≈")) = .txt◊°‘∫∫≈.Text
            End If
            If .txt–’√˚.Text <> "" Then
                blnFill = blnFill And UCase(mshList.TextMatrix(i, GetColNum("–’√˚"))) Like "*" & UCase(.txt–’√˚.Text) & "*"
            End If
        End With
        
        '¬˙◊„‘ÚÕÀ≥ˆ
        If blnFill Then
            mlngGo = i + 1
            mshList.Row = i: mshList.TopRow = i
            mshList.Col = 0: mshList.ColSel = mshList.Cols - 1
            
            strNo = mshList.TextMatrix(mshList.Row, GetColNum("µ•æ›∫≈"))
            int¿¥‘¥ = Val(mshList.TextMatrix(mshList.Row, GetColNum("±Í÷æ")))
            Call ShowDetail(mshList.TextMatrix(mshList.Row, GetColNum("Ω·’ ID")), , strNo, int¿¥‘¥)
            Call ShowMoney(mshList.TextMatrix(mshList.Row, GetColNum("Ω·’ ID")), , strNo)
            
            stbThis.Panels(2).Text = "’“µΩ“ªÃıº«¬º"
            Screen.MousePointer = 0: Exit Sub
        End If
        
        '∞¥ESC»°œ˚
        If mblnGo = False Then
            stbThis.Panels(2).Text = "”√ªß»°œ˚∂®Œª≤Ÿ◊˜"
            Screen.MousePointer = 0: Exit Sub
        End If
    Next
    mlngGo = 1
    stbThis.Panels(2).Text = "“—∂®ŒªµΩ«Âµ•Œ≤≤ø"
    Screen.MousePointer = 0
End Sub

Private Function GetColNum(strHead As String) As Integer
    Dim i As Long
    For i = 0 To mshList.Cols - 1
        If mshList.TextMatrix(0, i) = strHead Then GetColNum = i: Exit Function
    Next
End Function

Private Sub mnuEdit_Print_Click()
    Call PrintBill(0)
End Sub

Private Sub mnuEdit_Print_Supplemental_Click()
    Call PrintBill(1)
End Sub

Private Sub PrintBill(bytMode As Byte)
'π¶ƒ‹£∫µ±«∞ ’øÓº«¬º÷ÿ–¬¥Ú”°“ª’≈∆±æ›
'bytMode=0-÷ÿ¥Ú,1-≤π¥Ú
    Dim strNo As String, lngΩ·’ ID As Long, blnMediCare As Boolean, bytFlag As Byte '√≈’Ôªπ «◊°‘∫
    Dim intInsure As Integer
    Dim lng≤°»ÀID As Long, bytFunc As Byte
    
    strNo = mshList.TextMatrix(mshList.Row, GetColNum("µ•æ›∫≈"))
    If strNo = "" Then
        MsgBox "µ±«∞√ª”–µ•æ›ø…“‘÷ÿ¥Ú∆±æ›£°", vbInformation, gstrSysName
        Exit Sub
    End If
    lngΩ·’ ID = Val(mshList.TextMatrix(mshList.Row, GetColNum("Ω·’ ID")))
    lng≤°»ÀID = Val(mshList.TextMatrix(mshList.Row, GetColNum("≤°»ÀID")))
    bytFunc = IIf(Val(mshList.TextMatrix(mshList.Row, GetColNum("±Í÷æ"))) = 1, 0, 1)
    
    ' «∑Ò“—◊™»Î∫Û±∏ ˝æ›±Ì÷–
    If mblnNOMoved Then
        If Not ReturnMovedExes(strNo, 7, Me.Caption) Then Exit Sub
        mblnNOMoved = False  '¥À ±“—◊™»Î‘⁄œﬂ ˝æ›±Ì
    End If
    
     'µ•æ›»®œﬁ
    If bytMode = 0 Then
        If Not BillOperCheck(7, mshList.TextMatrix(mshList.Row, GetColNum("≤Ÿ◊˜‘±")), _
            CDate(mshList.TextMatrix(mshList.Row, GetColNum(" ’∑— ±º‰"))), "÷ÿ¥Ú") Then Exit Sub
    Else
        If Trim(mshList.TextMatrix(mshList.Row, GetColNum("∆±æ›∫≈"))) <> "" Then
            MsgBox "µ±«∞µ•æ›“—¥Ú”°π˝∆±æ›,≤ªƒ‹Ω¯––≤π¥Ú£°", vbExclamation, gstrSysName
            Exit Sub
        End If
    End If
    
    intInsure = BalanceExistInsure(strNo, bytFlag)
    If RePrintBalance(strNo, Me, lngΩ·’ ID, intInsure) Then
    
        '“¯“Ω“ªø®Õ®–¥ø®£¨85950
        Call WriteInforToCard(Me, mlngModul, mstrPrivs, gobjSquare.objSquareCard, 0, bytFunc, lngΩ·’ ID, lng≤°»ÀID)

        If mnuViewRefeshOptionItem(1).Checked Then
            If MsgBox("µ±«∞≤Ÿ◊˜“—∏¸∏ƒµ•æ›«Âµ•ƒ⁄»›,“™À¢–¬«Âµ•¬£ø", vbQuestion + vbYesNo + vbDefaultButton2, gstrSysName) = vbYes Then
                mnuViewReFlash_Click
            End If
        ElseIf mnuViewRefeshOptionItem(2).Checked Then
            mnuViewReFlash_Click
        End If
    End If
End Sub

Private Sub mshList_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If mshList.MouseRow = 0 Then
        mshList.MousePointer = 99
    Else
        mshList.MousePointer = 0
    End If
End Sub

Private Sub mshList_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    Dim lngCol As Long
    
    lngCol = mshList.MouseCol
    
    If Button = 1 And mshList.MousePointer = 99 Then
        If mshList.TextMatrix(0, lngCol) = "" Then Exit Sub
        If mshList.TextMatrix(1, GetColNum("µ•æ›∫≈")) = "" Then Exit Sub
        If mshList.ColWidth(lngCol) = 0 Then Exit Sub
        If mrsList Is Nothing Then Exit Sub
        
        Set mshList.DataSource = Nothing

        mrsList.Sort = mshList.TextMatrix(0, lngCol) & IIf(mshList.ColData(lngCol) = 0, "", " DESC")
        mshList.ColData(lngCol) = (mshList.ColData(lngCol) + 1) Mod 2
        
        Call ShowBills(, True)
    End If
End Sub

Private Sub SetHeader()
    Dim strHead As String
    Dim i As Long
    
    'Œ Ã‚65105:‘ˆº”√≈’Ô∫≈¡––≈œ¢
    strHead = "Ω·’ ID,1,0|±Í÷æ,1,0|“Ω±£,4,500|µ•æ›∫≈,4,850|∆±æ›∫≈,4,850|≤°»ÀID,1,750|√≈’Ô∫≈,1,750|◊°‘∫∫≈,1,750|–’√˚,4,800|–‘±,4,500|ƒÍ¡‰,4,500|∑—±,4,750|ø™ º»’∆⁄,4,1000|Ω· ¯»’∆⁄,4,1000|Ω·’ Ω∂Ó,7,850|≤Ÿ◊˜‘±,4,800| ’∑— ±º‰,4,1850|–£∂‘,4,500|÷–ÕæΩ·’ ,4,800|º«¬º◊¥Ã¨,1,0"
    
    With mshList
        .Redraw = False
        
        .Cols = UBound(Split(strHead, "|")) + 1
        For i = 0 To UBound(Split(strHead, "|"))
            .TextMatrix(0, i) = Split(Split(strHead, "|")(i), ",")(0)
            .ColAlignment(i) = Split(Split(strHead, "|")(i), ",")(1)
            If Not Visible Then .ColWidth(i) = Split(Split(strHead, "|")(i), ",")(2)
            .ColAlignmentFixed(i) = 4
        Next
        
        If Not Visible Then Call RestoreFlexState(mshList, App.ProductName & "\" & Me.Name)
        
        .RowHeight(0) = 320
        
        'ª÷∏¥…œ¥Œ––
        If mlngCurRow = 0 Then mlngCurRow = 1
        If mlngTopRow = 0 Then mlngTopRow = 1
        If mlngCurRow <= .Rows - 1 Then
            .Row = mlngCurRow
        Else
            .Row = .Rows - 1
        End If
        If mlngTopRow <= .Rows - 1 Then
            .TopRow = mlngTopRow
        Else
            .TopRow = .Row
        End If
        
        .Col = 0: .ColSel = .Cols - 1
        
        Call mshList_EnterCell

        .Redraw = True
    End With
End Sub

Private Sub ShowBills(Optional strIF As String, Optional blnSort As Boolean)
'π¶ƒ‹:∞¥Ãıº˛∂¡»°µ•æ›¡–±Ì(π˝¬Àπ¶ƒ‹)
'≤Œ ˝:strIF=“‘"AND"ø™ ºµƒÃıº˛¥Æ
'     blnSort=≤ª÷ÿ–¬∂¡»° ˝æ›,Ωˆ÷ÿ–¬œ‘ æ“—≈≈–Úµƒƒ⁄»›
    Dim i As Long, j As Long, k As Long, strTable As String, rsTemp As ADODB.Recordset
    Dim strSql As String, str¿¥‘¥ As String, strWhere As String
    
    
    On Error GoTo errH
    If Not blnSort Then
        Call zlCommFun.ShowFlash("’˝‘⁄∂¡»°µ•æ›¡–±Ì,«Î…‘∫Ú ...", Me)
        DoEvents
        Me.Refresh
        If SQLCondition.str¿¥‘¥ = "" Then SQLCondition.str¿¥‘¥ = "1111" '0000:√≈’Ô;◊°‘∫;ÃÂºÏ;∆‰À˚
            
        str¿¥‘¥ = ""
        For i = 1 To Len(SQLCondition.str¿¥‘¥)
            If Mid(SQLCondition.str¿¥‘¥, i, 1) = 1 Then
                str¿¥‘¥ = str¿¥‘¥ & "," & Choose(i, 1, 2, 4, 3)  '1-√≈’Ô;2-◊°‘∫;3-∆‰À˚(æÕ’Ôø®µ»∂ÓÕ‚µƒ ’∑—);4-ÃÂºÏ
            End If
        Next
        If str¿¥‘¥ <> "" Then str¿¥‘¥ = Mid(str¿¥‘¥, 2)
        If str¿¥‘¥ = "" Then str¿¥‘¥ = "-1"
        
        
        strTable = "" & _
        "   Select A.ID ,1 as ◊°‘∫±Í÷æ,0 as √≈’Ô±Í÷æ,A.NO,A. µº ∆±∫≈,A.≤°»ÀID,B.≤°»ÀID as ∑—”√≤°»ÀID,A.ø™ º»’∆⁄,A.Ω· ¯»’∆⁄,A.º«¬º◊¥Ã¨,B.Ω·’ Ω∂Ó,A.≤Ÿ◊˜‘±–’√˚,A. ’∑— ±º‰,A.÷–ÕæΩ·’ ,A.‘≠“Ú as ∫œ‘ºµ•Œª,A.Ω·’ ¿‡–Õ,B.÷˜“≥ID " & _
        "   From ≤°»ÀΩ·’ º«¬º A,◊°‘∫∑—”√º«¬º B,≤°»À–≈œ¢ C " & _
        "   Where A.ID=B.Ω·’ ID and  B.≤°»ÀID=C.≤°»ÀID" & _
                IIf(SQLCondition.str¿¥‘¥ = "1111", "", " And Instr(',' || [11] || ',', ',' || Nvl(B.√≈’Ô±Í÷æ,0) || ',') > 0 ") & strIF
        
        
        Select Case SQLCondition.str¿¥‘¥
        Case "1010", "1000", "0010"  '√≈’Ô
            strTable = Replace(strTable, "◊°‘∫∑—”√º«¬º", "√≈’Ô∑—”√º«¬º")
            strTable = Replace(strTable, "B.÷˜“≥ID", "Null As ÷˜“≥ID")
            strTable = Replace(strTable, "1 as ◊°‘∫±Í÷æ,0 as √≈’Ô±Í÷æ", "0 as ◊°‘∫±Í÷æ,1 as √≈’Ô±Í÷æ")
        Case "0101", "0001", "0100" '◊°‘∫
            '“—æ≠¥Ê‘⁄
        Case Else '√≈’Ô∫Õ◊°‘∫
            strTable = strTable & vbCrLf & " Union ALL " & vbCrLf & Replace(Replace(Replace(strTable, "◊°‘∫∑—”√º«¬º", "√≈’Ô∑—”√º«¬º"), "1 as ◊°‘∫±Í÷æ,0 as √≈’Ô±Í÷æ", "0 as ◊°‘∫±Í÷æ,1 as √≈’Ô±Í÷æ"), "B.÷˜“≥ID", "Null As ÷˜“≥ID")
        End Select
        
        If frmBalanceFilter.mblnDateMoved Then
            strTable = strTable & vbCrLf & " Union ALL " & vbCrLf & Replace(Replace(Replace(strTable, "≤°»ÀΩ·’ º«¬º", "H≤°»ÀΩ·’ º«¬º"), "◊°‘∫∑—”√º«¬º", "H◊°‘∫∑—”√º«¬º"), "√≈’Ô∑—”√º«¬º", "H√≈’Ô∑—”√º«¬º")
        End If
        
        'Œ Ã‚65105,¡ı∂˚–˝:√≈’ÔΩ·’  ±≤≈œ‘ æ√≈’Ô∫≈
        strSql = _
        " Select A.ID Ω·’ ID,decode(Max(◊°‘∫±Í÷æ),1,decode(max(√≈’Ô±Í÷æ),1,3,2),1) as ±Í÷æ ,Decode(P.œ’¿‡,NULL,Decode(C.œ’¿‡,NULL,NULL,'°Ã'),'°Ã') as “Ω±£,A.NO as µ•æ›∫≈,A. µº ∆±∫≈ as ∆±æ›∫≈," & _
        "        Decode(A.≤°»ÀID,Null,' ',A.≤°»ÀID) ≤°»ÀID,Decode(Nvl(A.Ω·’ ¿‡–Õ,0),2,' ',Decode(A.≤°»ÀID,Null,' ',C.√≈’Ô∫≈)) √≈’Ô∫≈,Decode(A.≤°»ÀID,Null,' ',Nvl(P.◊°‘∫∫≈,C.◊°‘∫∫≈)) ◊°‘∫∫≈," & _
        "        Decode(A.≤°»ÀID,Null,nvl(A.∫œ‘ºµ•Œª,Q.√˚≥∆),C.–’√˚) –’√˚,Decode(A.≤°»ÀID,Null,' ',C.–‘±) –‘±," & _
        "        Decode(A.≤°»ÀID,Null,' ',C.ƒÍ¡‰) ƒÍ¡‰,Decode(A.≤°»ÀID,Null,' ',Nvl(P.∑—±,C.∑—±)) as ∑—±," & _
        "        To_Char(A.ø™ º»’∆⁄,'YYYY-MM-DD') as ø™ º»’∆⁄,To_Char(A.Ω· ¯»’∆⁄,'YYYY-MM-DD') as Ω· ¯»’∆⁄," & _
        "        To_Char(Sum(Decode(A.º«¬º◊¥Ã¨,2,-1,1) *A.Ω·’ Ω∂Ó),'999999999" & gstrDec & "') as Ω·’ Ω∂Ó," & _
        "        A.≤Ÿ◊˜‘±–’√˚ as ≤Ÿ◊˜‘±,To_Char(A. ’∑— ±º‰,'YYYY-MM-DD HH24:MI:SS') as  ’∑— ±º‰," & _
        "        ' '  as –£∂‘," & _
        "        Decode(Nvl(A.÷–ÕæΩ·’ ,0),1,'°Ã',' ') ÷–ÕæΩ·’ ,Max(A.º«¬º◊¥Ã¨) as º«¬º◊¥Ã¨" & _
        " From ( " & strTable & ") A,≤°»À–≈œ¢ C,≤°∞∏÷˜“≥ P,∫œ‘ºµ•Œª Q,»À‘±±Ì N" & _
        " Where  A.∑—”√≤°»ÀID=C.≤°»ÀID And A.≤Ÿ◊˜‘±–’√˚=N.–’√˚  " & _
        "        And A.∑—”√≤°»ÀID=P.≤°»ÀID(+) And Nvl(A.÷˜“≥ID,0)=P.÷˜“≥ID(+) And C.∫œÕ¨µ•ŒªID=Q.ID(+)" & _
        "       And (N.’æµ„='" & gstrNodeNo & "' Or N.’æµ„ is Null)" & vbNewLine & _
        " Group by A.ID,Decode(P.œ’¿‡,NULL,Decode(C.œ’¿‡,NULL,NULL,'°Ã'),'°Ã'),A.NO,A. µº ∆±∫≈,Decode(A.≤°»ÀID,Null,' ',A.≤°»ÀID),Decode(Nvl(A.Ω·’ ¿‡–Õ,0),2,' ',Decode(A.≤°»ÀID,Null,' ',C.√≈’Ô∫≈)),Decode(A.≤°»ÀID,Null,' ',Nvl(P.◊°‘∫∫≈,C.◊°‘∫∫≈))," & _
        "           Decode(A.≤°»ÀID,Null,nvl(A.∫œ‘ºµ•Œª,Q.√˚≥∆),C.–’√˚),Decode(A.≤°»ÀID,Null,' ',C.–‘±),Decode(A.≤°»ÀID,Null,' ',C.ƒÍ¡‰),Decode(A.≤°»ÀID,Null,' ',Nvl(P.∑—±,C.∑—±))," & _
        "           To_Char(A.ø™ º»’∆⁄,'YYYY-MM-DD'),To_Char(A.Ω· ¯»’∆⁄,'YYYY-MM-DD')," & _
        "           A.≤Ÿ◊˜‘±–’√˚,To_Char(A. ’∑— ±º‰,'YYYY-MM-DD HH24:MI:SS'),Decode(Nvl(A.÷–ÕæΩ·’ ,0),1,'°Ã',' ')"
        
        strSql = strSql & " Order by  ’∑— ±º‰ Desc,µ•æ›∫≈ Desc"
        
        With SQLCondition
            If .Default Then
                Set mrsList = zlDatabase.OpenSQLRecord(strSql, Me.Caption, .Operator, "", "", "", "", "", 0, "", "", "", str¿¥‘¥)
            Else
                Set mrsList = zlDatabase.OpenSQLRecord(strSql, Me.Caption, .DateB, .DateE, .NOB, .NOE, .FactB, .FactE, Val(.InPatientID), .Patient, .Operator, .OutExseID, str¿¥‘¥)
            End If
        End With
    End If
    
    mshList.Redraw = False
    mshList.Clear
    mshList.Rows = 2
    
    mshDetail.Clear
    mshDetail.Rows = 2
    
    mshMoney.Clear
    mshMoney.Rows = 2
    
    If mrsList.EOF Then
        stbThis.Panels(2).Text = "µ±«∞…Ë÷√√ª”–π˝¬À≥ˆ»Œ∫Œµ•æ›"
        Call SetMenu(False)
    Else
        Set mshList.DataSource = mrsList
        stbThis.Panels(2) = "π≤ " & mrsList.RecordCount & " ’≈µ•æ›"
        Call SetMenu(True)
    End If
    
    '…Ë÷√—’…´
    If SQLCondition.Flag = 2 Then
        mshList.ForeColor = &HC0
    Else
        mshList.ForeColor = ForeColor
        k = GetColNum("º«¬º◊¥Ã¨")
        For i = 1 To mshList.Rows - 1
            If Val(mshList.TextMatrix(i, k)) = 2 Then
                'ÕÀ∑—º«¬º”√∫Ï…´
                mshList.Row = i
                For j = 0 To mshList.Cols - 1
                    mshList.Col = j
                    mshList.CellForeColor = &HC0
                Next
            ElseIf Val(mshList.TextMatrix(i, k)) = 3 Then
                '∞¸∫¨ÕÀπ˝∑—µƒ”√¿∂…´
                mshList.Row = i
                For j = 0 To mshList.Cols - 1
                    mshList.Col = j
                    mshList.CellForeColor = &HC00000
                Next
            End If
            strSql = "Select 1 From ±£œ’Ω·À„√˜œ∏ Where Ω·’ ID=[1] And ±Í÷æ=1 And Ω·À„∑Ω Ω <> 'œ÷Ω'"
            Set rsTemp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, Val(mshList.TextMatrix(i, GetColNum("Ω·’ ID"))))
            If Not rsTemp.EOF Then
                mshList.TextMatrix(i, GetColNum("–£∂‘")) = "°Ã"
            Else
                mshList.TextMatrix(i, GetColNum("–£∂‘")) = ""
            End If
        Next
    End If
    
    Call SetHeader '¥Àπ˝≥Ã“—∞¸¿®Call SetDetail,Call SetMoney
    
    If mshList.Row = 0 Or mshList.TextMatrix(mshList.Row, GetColNum("Ω·’ ID")) = "" Then
        Call SetDetail
        Call SetMoney
    End If
    
    If Not blnSort Then Call zlCommFun.StopFlash
    mshList.Redraw = True
    Me.Refresh
    Exit Sub
errH:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
    mshList.Redraw = True
End Sub

Private Sub ShowDetail(Optional lngΩ·’ ID As Long, Optional blnSort As Boolean, Optional strNo As String, Optional int¿¥‘¥ As Integer = 2)
    '------------------------------------------------------------------------------------------------------------------------
    'π¶ƒ‹£∫œ‘ æ√˜œ∏∑—”√º«¬º
    '»Î≤Œ£∫int¿¥‘¥-1-√≈’Ô;2-◊°‘∫;3-√≈’Ô∫Õ◊°‘∫
    '≥ˆ≤Œ£∫
    '∑µªÿ£∫
    '±‡÷∆£∫¡ı–À∫È
    '»’∆⁄£∫2010-03-08 19:34:16
    'Àµ√˜£∫
    '------------------------------------------------------------------------------------------------------------------------

    Dim i As Long, j As Long, strSql As String, strDec As String
    Dim rsTmp As ADODB.Recordset
    
    On Error GoTo errH
    
    If Not blnSort Then
        
        If frmBalanceFilter.mblnDateMoved Then
            'Ω·’ µ•Õ®π˝Ω·’ ID”Î∑—”√º«¬ºœ‡¡¨,»Áπ˚÷∏∂®NO∫≈µƒΩ·’ µ•‘⁄∫Û±∏±Ì÷–,‘Ú∏√¥ŒΩ·’ µƒµ•æ›∫≈“ª∂®‘⁄∫Û±∏±Ì÷–
            '“ª’≈Ω·’ µ•πÿ¡™µƒº«’ µ•≤ªø…ƒ‹Õ¨ ±‘⁄‘⁄œﬂ±Ì∫Õ∫Û±∏±Ì÷–
            mblnNOMoved = zlDatabase.NOMoved("≤°»ÀΩ·’ º«¬º", strNo, , , Me.Caption)
        Else
            mblnNOMoved = False   '±ÿ–Î“™”–’‚“ªæ‰
        End If
        
        strDec = gstrDec
        If lngΩ·’ ID <> 0 Then
            Select Case int¿¥‘¥
            Case 1 '√≈’Ô
                strSql = "Select Max(Length(Abs(Ω·’ Ω∂Ó) - Trunc(Abs(Ω·’ Ω∂Ó))))-1 declen From " & IIf(mblnNOMoved, "H", "") & "√≈’Ô∑—”√º«¬º Where Ω·’ ID=[1]"
            Case 2 '◊°‘∫
                strSql = "Select Max(Length(Abs(Ω·’ Ω∂Ó) - Trunc(Abs(Ω·’ Ω∂Ó))))-1 declen From " & IIf(mblnNOMoved, "H", "") & "◊°‘∫∑—”√º«¬º Where Ω·’ ID=[1]"
            Case Else
                
                strSql = "Select Length(Abs(Ω·’ Ω∂Ó) - Trunc(Abs(Ω·’ Ω∂Ó)))  as  declen From " & IIf(mblnNOMoved, "H", "") & "√≈’Ô∑—”√º«¬º Where Ω·’ ID=[1] Union ALL " & _
                         "Select Length(Abs(Ω·’ Ω∂Ó) - Trunc(Abs(Ω·’ Ω∂Ó)))   as  declen  From " & IIf(mblnNOMoved, "H", "") & "◊°‘∫∑—”√º«¬º Where Ω·’ ID=[1]"
                strSql = "Select Max(declen)-1 as declen  From ( " & strSql & ")"
            End Select
            Set rsTmp = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngΩ·’ ID)
            If rsTmp.RecordCount > 0 Then
                If Len(strDec) < Len("0." & String(rsTmp!declen, "0")) Then
                    strDec = "0." & String(rsTmp!declen, "0")
                End If
            End If
        End If
        
        Select Case int¿¥‘¥
        Case 1  '√≈’Ô
            strSql = " (Select Ω·’ ID,NO,–Ú∫≈,ø™µ•≤ø√≈ID, ’∑—œ∏ƒøID,√≈’Ô±Í÷æ,0 as ÷˜“≥ID, ’æ›∑—ƒø,”§∂˘∑—,Ω·’ Ω∂Ó,∑¢…˙ ±º‰ From " & IIf(mblnNOMoved, "H", "") & "√≈’Ô∑—”√º«¬º A where A.Ω·’ ID=[1] ) A "
            'strSQL = IIf(mblnNOMoved, "H", "") & "√≈’Ô∑—”√º«¬º A "
        Case 2  '◊°‘∫
            strSql = IIf(mblnNOMoved, "H", "") & "◊°‘∫∑—”√º«¬º A"
        Case Else '√≈’Ô∫Õ◊°‘∫
            strSql = " (Select Ω·’ ID,NO,–Ú∫≈,ø™µ•≤ø√≈ID, ’∑—œ∏ƒøID,√≈’Ô±Í÷æ,0 as ÷˜“≥ID, ’æ›∑—ƒø,”§∂˘∑—,Ω·’ Ω∂Ó,∑¢…˙ ±º‰ From " & IIf(mblnNOMoved, "H", "") & "√≈’Ô∑—”√º«¬º A where A.Ω·’ ID=[1] Union ALL " & _
                       " Select Ω·’ ID,NO,–Ú∫≈,ø™µ•≤ø√≈ID, ’∑—œ∏ƒøID,√≈’Ô±Í÷æ,÷˜“≥ID, ’æ›∑—ƒø,”§∂˘∑—,Ω·’ Ω∂Ó,∑¢…˙ ±º‰ From " & IIf(mblnNOMoved, "H", "") & "◊°‘∫∑—”√º«¬º A where A.Ω·’ ID=[1] )  A"
        End Select
        
        strSql = _
        "   Select Decode(√≈’Ô±Í÷æ,1,'√≈’Ô',4,'√≈’Ô','µ⁄'||Nvl(A.÷˜“≥ID,0)||'¥Œ') as ◊°‘∫," & _
        "         A.NO as µ•æ›∫≈,Nvl(B.√˚≥∆,'Œ¥÷™') as ø™µ•ø∆ “,Nvl(E.√˚≥∆,D.√˚≥∆) as œÓƒø," & IIf(gTy_System_Para.byt“©∆∑√˚≥∆œ‘ æ = 2, "E1.√˚≥∆ as …Ã∆∑√˚,", "") & _
        "       A. ’æ›∑—ƒø as ∑—ƒø,Decode(Nvl(A.”§∂˘∑—,0),0,'','°Ã') as ”§∂˘∑—," & _
        "       To_Char(" & IIf(mbytType = 2, "-1*", "") & "A.Ω·’ Ω∂Ó,'999999999" & strDec & "') as Ω·’ Ω∂Ó," & _
        "       To_Char(A.∑¢…˙ ±º‰,'YYYY-MM-DD HH24:MI:SS') as ∑—”√ ±º‰" & _
        " From " & strSql & ",≤ø√≈±Ì B, ’∑—œÓƒøƒø¬º D, ’∑—œÓƒø±√˚ E" & _
                IIf(gTy_System_Para.byt“©∆∑√˚≥∆œ‘ æ = 2, ", ’∑—œÓƒø±√˚ E1", "") & _
        " Where A.ø™µ•≤ø√≈ID=B.ID(+) And A. ’∑—œ∏ƒøID=D.ID" & _
        "       And A. ’∑—œ∏ƒøID=E. ’∑—œ∏ƒøID(+) And E.¬Î¿‡(+)=1 And E.–‘÷ (+)=" & IIf(gTy_System_Para.byt“©∆∑√˚≥∆œ‘ æ = 1, 3, 1) & _
                IIf(gTy_System_Para.byt“©∆∑√˚≥∆œ‘ æ = 2, "       And A. ’∑—œ∏ƒøID=E1. ’∑—œ∏ƒøID(+) And E1.¬Î¿‡(+)=1 And E1.–‘÷ (+)=3", "") & _
        "       And A.Ω·’ ID=[1]" & _
        " Order by ◊°‘∫ Desc,∑—”√ ±º‰ Desc,µ•æ›∫≈ Desc,A.–Ú∫≈"
        Set mrsDetail = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngΩ·’ ID)
    End If
    
    mshDetail.Redraw = False
    mshDetail.Clear
    mshDetail.Rows = 2
    mshDetail.ForeColor = IIf(mbytType = 2, &HC0, ForeColor)

    If Not mrsDetail.EOF Then Set mshDetail.DataSource = mrsDetail
    
    '…Ë÷√—’…´
    If mbytType = 2 Then
        'ÕÀ∑—÷±Ω”Œ™∫Ï…´
        mshDetail.ForeColor = &HC0
    Else
        '‘≠ ºµ•æ›ÕÀπ˝µƒŒ™¿∂…´
        mshDetail.ForeColor = ForeColor
        If mbytType = 3 Then
            For i = 1 To mshDetail.Rows - 1
                mshDetail.Row = i
                For j = 0 To mshDetail.Cols - 1
                    mshDetail.Col = j
                    mshDetail.CellForeColor = &HC00000
                Next
            Next
        End If
    End If
    
    Call SetDetail
    mshDetail.Redraw = True
    Exit Sub
errH:
    If ErrCenter() = 1 Then
        Resume
    End If
    Call SaveErrLog
    mshDetail.Redraw = True
End Sub

Private Sub SetDetail()
    Dim strHead As String
    Dim i As Long
    
    strHead = "◊°‘∫,4,750|µ•æ›∫≈,4,850|ø™µ•ø∆ “,1,850|œÓƒø,1,1800" & IIf(gTy_System_Para.byt“©∆∑√˚≥∆œ‘ æ = 2, "|…Ã∆∑√˚,1,1600", "") & "|∑—ƒø,1,850|”§∂˘∑—,4,650|Ω·’ Ω∂Ó,7,850|∑—”√ ±º‰,1,1850"
    
    With mshDetail
        .Redraw = False
        
        .Cols = UBound(Split(strHead, "|")) + 1
        For i = 0 To UBound(Split(strHead, "|"))
            .TextMatrix(0, i) = Split(Split(strHead, "|")(i), ",")(0)
            .ColAlignment(i) = Split(Split(strHead, "|")(i), ",")(1)
            If Not Visible Then .ColWidth(i) = Split(Split(strHead, "|")(i), ",")(2)
            .ColAlignmentFixed(i) = 4
        Next
        
        If Not Visible Then Call RestoreFlexState(mshDetail, App.ProductName & "\" & Me.Name)
        '¡ı–À∫È:27990 2010-02-22 17:34:32
        For i = 0 To .Cols - 1
            If .TextMatrix(0, i) = "…Ã∆∑√˚" Then
                If gTy_System_Para.byt“©∆∑√˚≥∆œ‘ æ = 2 Then
                    If .ColWidth(i) <= 0 Then .ColWidth(i) = 1600
                Else
                    .ColWidth(i) = 0
                End If
            End If
        Next
                
        .RowHeight(0) = 320
        
        .Row = 1: .Col = 0: .ColSel = .Cols - 1
        Call mshDetail_EnterCell
        
        .Redraw = True
    End With
End Sub

Private Sub ShowMoney(Optional lngΩ·’ ID As Long, Optional blnSort As Boolean, _
    Optional strNo As String)
    Dim i As Long, strSql As String
    On Error GoTo errH
    
    '»Áπ˚µ±«∞Ω·’ µ•‘⁄∫Û±∏±Ì÷–,‘ÚÀ¸œ‡πÿµƒΩ·’ ∑Ω Ω“ª∂®‘⁄∫Û±∏±Ì÷–
    If Not blnSort Then
        strSql = "" & _
        " Select Decode(Substr(º«¬º–‘÷ ,Length(º«¬º–‘÷ ),1),1,'≥Â‘§Ωª',2,'≤πøÓ') as ¿‡–Õ," & _
        "       NO as µ•æ›∫≈,To_Char(" & IIf(mbytType = 2, "-1*", "") & "≥Â‘§Ωª,'FM9999999990.00999') as Ω∂Ó," & _
        "       Ω·À„∑Ω Ω,Ω·À„∫≈¬Î" & _
        " From ≤°»À‘§Ωªº«¬º " & _
        " Where Ω·’ ID=[1] And ≥Â‘§Ωª <> 0 " & _
        " Order by ¿‡–Õ Desc,NO Desc,Ω·À„∑Ω Ω"
        If mblnNOMoved Then strSql = Replace(strSql, "≤°»À‘§Ωªº«¬º", "H≤°»À‘§Ωªº«¬º")
        Set mrsMoney = zlDatabase.OpenSQLRecord(strSql, Me.Caption, lngΩ·’ ID)
    End If
    
    mshMoney.Clear
    mshMoney.Rows = 2
    mshMoney.ForeColor = mshList.ForeColor
    If Not mrsMoney.EOF Then Set mshMoney.DataSource = mrsMoney
    Call SetMoney
    Exit Sub
errH:
    If ErrCenter() = 1 Then Resume
    Call SaveErrLog
End Sub

Private Sub SetMoney()
    Dim strHead As String
    Dim i As Long
    
    strHead = "¿‡–Õ,4,650|µ•æ›∫≈,4,850|Ω∂Ó,7,850|Ω·À„∑Ω Ω,1,850|Ω·À„∫≈¬Î,1,1000"
    With mshMoney
        .Redraw = False
        
        .Cols = UBound(Split(strHead, "|")) + 1
        For i = 0 To UBound(Split(strHead, "|"))
            .TextMatrix(0, i) = Split(Split(strHead, "|")(i), ",")(0)
            .ColAlignment(i) = Split(Split(strHead, "|")(i), ",")(1)
            If Not Visible Then .ColWidth(i) = Split(Split(strHead, "|")(i), ",")(2)
            .ColAlignmentFixed(i) = 4
        Next
        
        If Not Visible Then Call RestoreFlexState(mshMoney, App.ProductName & "\" & Me.Name)
        
        .RowHeight(0) = 320
        
        .Row = 1: .Col = 0: .ColSel = .Cols - 1
        Call mshMoney_EnterCell
        
        .Redraw = True
    End With
End Sub

Private Sub mshDetail_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If mshDetail.MouseRow = 0 Then
        mshDetail.MousePointer = 99
    Else
        mshDetail.MousePointer = 0
    End If
End Sub

Private Sub mshDetail_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    Dim lngCol As Long
    
    lngCol = mshDetail.MouseCol
    
    If Button = 1 And mshDetail.MousePointer = 99 Then
        If mshDetail.TextMatrix(0, lngCol) = "" Then Exit Sub
        If mshDetail.TextMatrix(1, 0) = "" Then Exit Sub
        If mrsDetail Is Nothing Then Exit Sub
        
        Set mshDetail.DataSource = Nothing

        mrsDetail.Sort = mshDetail.TextMatrix(0, lngCol) & IIf(mshDetail.ColData(lngCol) = 0, "", " DESC")
        mshDetail.ColData(lngCol) = (mshDetail.ColData(lngCol) + 1) Mod 2
        
        Call ShowDetail(, True)
    End If
End Sub

Private Sub mshMoney_MouseMove(Button As Integer, Shift As Integer, X As Single, Y As Single)
    If mshMoney.MouseRow = 0 Then
        mshMoney.MousePointer = 99
    Else
        mshMoney.MousePointer = 0
    End If
End Sub

Private Sub mshMoney_MouseUp(Button As Integer, Shift As Integer, X As Single, Y As Single)
    Dim lngCol As Long
    
    lngCol = mshMoney.MouseCol
    
    If Button = 1 And mshMoney.MousePointer = 99 Then
        If mshMoney.TextMatrix(0, lngCol) = "" Then Exit Sub
        If mshMoney.TextMatrix(1, 0) = "" Then Exit Sub
        If mrsMoney Is Nothing Then Exit Sub
        
        Set mshMoney.DataSource = Nothing

        mrsMoney.Sort = mshMoney.TextMatrix(0, lngCol) & IIf(mshMoney.ColData(lngCol) = 0, "", " DESC")
        mshMoney.ColData(lngCol) = (mshMoney.ColData(lngCol) + 1) Mod 2
        
        Call ShowMoney(, True)
    End If
End Sub

Private Sub PrintDetail()
'π¶ƒ‹£∫ ‰»Î≥ˆ¡–±Ì
    Dim objOut As New zlPrint1Grd
    Dim objRow As New zlTabAppRow
    Dim bytR As Byte, intRow As Integer
    
    intRow = mshDetail.Row
    
    '±ÌÕ∑
    objOut.Title.Text = "≤°»ÀΩ·’ µ•æ›√˜œ∏"
    objOut.Title.Font.Name = "ø¨ÃÂ_GB2312"
    objOut.Title.Font.Size = 18
    objOut.Title.Font.Bold = True
    
    '±ÌœÓ
    With frmBalanceFilter
        objRow.Add "µ•æ›∫≈£∫" & mshList.TextMatrix(mshList.Row, GetColNum("µ•æ›∫≈"))
        objRow.Add "Ω·’ ∑∂Œß£∫" & mshList.TextMatrix(mshList.Row, GetColNum("ø™ º»’∆⁄")) & " ÷¡ " & mshList.TextMatrix(mshList.Row, GetColNum("Ω· ¯»’∆⁄"))
        objOut.UnderAppRows.Add objRow
    
        Set objRow = New zlTabAppRow
        objRow.Add "◊°‘∫∫≈£∫" & mshList.TextMatrix(mshList.Row, GetColNum("◊°‘∫∫≈"))
        objRow.Add "–’√˚£∫" & mshList.TextMatrix(mshList.Row, GetColNum("–’√˚"))
        objOut.UnderAppRows.Add objRow
    End With
    
    Set objRow = New zlTabAppRow
    objRow.Add "¥Ú”°»À£∫" & UserInfo.–’√˚
    objRow.Add "¥Ú”°»’∆⁄£∫" & Format(zlDatabase.Currentdate(), "yyyyƒÍMM‘¬dd»’")
    objOut.BelowAppRows.Add objRow
    
    '±ÌÃÂ
    mshDetail.Redraw = False
    Set objOut.Body = mshDetail
    
    bytR = zlPrintAsk(objOut)
    Me.Refresh
    If bytR <> 0 Then zlPrintOrView1Grd objOut, bytR
    
    mshDetail.Row = intRow
    mshDetail.Col = 0: mshDetail.ColSel = mshDetail.Cols - 1
    mshDetail.Redraw = True
End Sub

Private Sub mnuViewRefeshOptionItem_Click(Index As Integer)
    Dim i As Long
    For i = 0 To mnuViewRefeshOptionItem.UBound
        mnuViewRefeshOptionItem(i).Checked = i = Index
    Next
End Sub


Private Sub mnuHelpWebForum_Click()
    '-----------------------------------------------------------------------------
    'π¶ƒ‹:¡¥Ω”µΩ÷–¡™¬€Ã≥
    '–ﬁ∏ƒ»À:¡ı–À∫Í
    '–ﬁ∏ƒ»’∆⁄:2006-12-11
    '-----------------------------------------------------------------------------
    Call zlWebForum(Me.hWnd)
End Sub

